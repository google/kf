<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="canonical" type="text/html" href="https://google.github.io/kf/docs/v2.11/operator/service-brokers/cloud-sb-overview/">
<link rel="alternate" type="application/rss&#43;xml" href="https://google.github.io/kf/docs/v2.11/operator/service-brokers/cloud-sb-overview/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/kf/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/kf/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/kf/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/kf/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/kf/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/kf/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/kf/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/kf/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/kf/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/kf/favicons/android-192x192.png" sizes="192x192">

<title>About Kf Cloud Service Broker | Kf</title>
<meta name="description" content="The Kf Cloud Service Broker is a Service Broker bundle that includes the open source
Cloud Service Broker
and Google Cloud Brokerpak.
It is made …">
<meta property="og:title" content="About Kf Cloud Service Broker" />
<meta property="og:description" content="A Cloud Foundry inspired MicroPAAS for Kubernetes." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://google.github.io/kf/docs/v2.11/operator/service-brokers/cloud-sb-overview/" /><meta property="og:site_name" content="Kf" />

<meta itemprop="name" content="About Kf Cloud Service Broker">
<meta itemprop="description" content="A Cloud Foundry inspired MicroPAAS for Kubernetes."><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="About Kf Cloud Service Broker"/>
<meta name="twitter:description" content="A Cloud Foundry inspired MicroPAAS for Kubernetes."/>




<link rel="preload" href="/kf/scss/main.min.cd6c2bbb05cdf98237b53882fed8c7a8b3fd7a7f7963d7cb305dd0d984782137.css" as="style">
<link href="/kf/scss/main.min.cd6c2bbb05cdf98237b53882fed8c7a8b3fd7a7f7963d7cb305dd0d984782137.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/kf/">
		<span class="navbar-logo"></span><span class="font-weight-bold">Kf</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/kf/docs/v2.11/developer/" ><span>Developer Guide</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/kf/docs/v2.11/operator/" ><span class="active">Operator Guide</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/kf/docs/v2.11/troubleshooting/" ><span>Troubleshooting</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/kf/offline-search-index.7286fcd87331c972fd64c843afb49d7c.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/kf/docs/v2.11/operator/service-brokers/cloud-sb-overview/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">About Kf Cloud Service Broker</h1>





    <ul>
    
  
  
  
  

  

    </ul>


<div class="content">
      <p>The Kf Cloud Service Broker is a Service Broker bundle that includes the open source
<a href="https://github.com/cloudfoundry-incubator/cloud-service-broker">Cloud Service Broker</a>
and <a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp">Google Cloud Brokerpak</a>.
It is made available as a public Docker image and ready to deploy as a
Kubernetes service in Kf clusters. Once the
Kf Cloud Service Broker service is deployed in a cluster, developers can provision Google Cloud
backing services through the Kf Cloud Service Broker service, and bind the backing services to Kf Apps.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Kf Cloud Service Brokeris not customizable, and the default
Google Cloud Brokerpak is included. If you would like to use a custom
Brokerpak, you can follow the steps in the
<a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp/blob/main/docs/gcp-installation.md">open source Cloud Service Broker Google Cloud installation guide</a>.
</aside>

<h2 id="requirements">Requirements</h2>
<ul>
<li>Kf Cloud Service Broker requires a MySQL instance and a service account for accessing the MySQL instance and Google Cloud backing services to be provisioned. Connection from the Kf Cloud Service Broker to the MySQL instance goes through the <a href="https://cloud.google.com/sql/docs/mysql/sql-proxy">Cloud SQL Auth Proxy</a>.</li>
<li>Requests to access Google Cloud services (for example: Cloud SQL for MySQL or Cloud Memorystore for Redis) are authenticated via <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity">Workload Identity</a>.</li>
</ul>
<h2 id="override-brokerpak-defaults">Override Brokerpak defaults</h2>
<p>Brokerpaks are essentially a Terraform plan and related dependencies in a tar
file. You can inspect the Terraform plans to see what the defaults are, and then
you can tell Kf Cloud Service Broker to override them when creating new services.</p>
<p>For example, the <a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp/blob/main/terraform/cloud-sql-provision.tf">Terraform plan for MySQL</a> includes a variable called <code>authorized_network</code>. If not overridden, the <code>default</code> VPC will be used. If you&rsquo;d like to override the default, you can pass that during service creation. Here are some examples:</p>
<ol>
<li>Override the compute region <code>config</code>.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> kf create-service csb-google-postgres small spring-music-postgres-db -c <span style="color:#4e9a06">&#39;{&#34;config&#34;:&#34;YOUR_COMPUTE_REGION&#34;}&#39;</span>
</span></span></code></pre></div><ol>
<li>Override the <code>authorized_network</code> and compute region <code>config</code>.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> kf create-service csb-google-postgres small spring-music-postgres-db -c <span style="color:#4e9a06">&#39;{&#34;config&#34;:&#34;YOUR_COMPUTE_REGION&#34;,&#34;authorized_network&#34;:&#34;YOUR_CUSTOM_VPC_NAME&#34;}&#39;</span>
</span></span></code></pre></div><p>You can learn more by reading the <a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp/blob/main/docs/mysql-plans-and-config.md">MySQL Plans and Configs</a> documentation.</p>
<h2 id="architecture">Architecture</h2>
<p>The following Kf Cloud Service Broker architecture shows how instances are created.</p>

<figure>
    <img src="./kf-csb-architecture.svg"
         alt="Kf Cloud Service Broker architecture"/> 
</figure>

<ul>
<li>The Kf Cloud Service Broker (CSB) is installed in its own namespace.</li>
<li>On installation, a MySQL instance must be provided to persist
business logic used by Kf Cloud Service Broker. Requests are sent securely
from the Kf Cloud Service Broker pod to the MySQL instance via
the MySQL Auth Proxy.</li>
<li>On service provisioning, a Kf Service custom resource
is created. The reconciler of the Kf Service
provisions Google Cloud backing services using the Open Service Broker API.</li>
<li>When a request to provision/deprovision backing resources is received,
Kf Cloud Service Broker sends resource creation/deletion requests to the
corresponding Google Cloud service, and these requests are authenticated
with Workload Identity. It also persists the business logics (e.g. mapping of
Kf services to backing services, service bindings) to
the MySQL instance.</li>
<li>On backing service creation success, the backing service is bound to an App
via <a href="/kf/docs/v2.11/developer/build-and-deploy/app-runtime/#vcapservices">VCAP_SERVICES</a>.</li>
</ul>
<h2 id="whats-next">What&rsquo;s next?</h2>
<ul>
<li><a href="/kf/docs/v2.11/operator/service-brokers/deploying-cloud-sb/">Deploy Kf Cloud Service Broker</a>.</li>
<li><a href="/kf/docs/v2.11/developer/backing-services/managed-services/">Learn how to list and provision services</a>.</li>
</ul>
<p>{% endblock %}</p>

</div>
</div>


  
  
  
  

  
  

  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/google/kf" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Security mailing list" aria-label="Security mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="mailto:kf-security@google.com" aria-label="Security mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Kf Authors All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/kf/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>




  </body>
</html>
