<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.101.0" />
<link rel="canonical" type="text/html" href="/docs/v2.11/operator/">
<link rel="alternate" type="application/rss&#43;xml" href="/docs/v2.11/operator/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/favicons/android-192x192.png" sizes="192x192">

<title>Operate and Maintain Kf | Kf</title>
<meta name="description" content="Learn to run and maintain Kf as a platform.">
<meta property="og:title" content="Operate and Maintain Kf" />
<meta property="og:description" content="Learn to run and maintain Kf as a platform." />
<meta property="og:type" content="website" />
<meta property="og:url" content="/docs/v2.11/operator/" /><meta property="og:site_name" content="Kf" />

<meta itemprop="name" content="Operate and Maintain Kf">
<meta itemprop="description" content="Learn to run and maintain Kf as a platform."><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Operate and Maintain Kf"/>
<meta name="twitter:description" content="Learn to run and maintain Kf as a platform."/>




<link rel="preload" href="/scss/main.scss" as="style">
<link href="/scss/main.scss" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script
  src="https://unpkg.com/lunr@2.3.9/lunr.min.js"
  integrity="sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli"
  crossorigin="anonymous"></script>

  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/">
		<span class="navbar-logo"></span><span class="font-weight-bold">Kf</span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/v2.11/developer/" ><span>Developer Guide</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link active" href="/docs/v2.11/operator/" ><span class="active">Operator Guide</span></a>
			</li>
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				
				
				
				
				<a class="nav-link" href="/docs/v2.11/troubleshooting/" ><span>Troubleshooting</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block"><input
  type="search"
  class="form-control td-search-input"
  placeholder="&#xf002; Search this site…"
  aria-label="Search this site…"
  autocomplete="off"
  
  data-offline-search-index-json-src="/offline-search-index.8271768637bdb31d52e7c162697e4315.json"
  data-offline-search-base-href="/"
  data-offline-search-max-results="10"
>
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/docs/v2.11/operator/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Operate and Maintain Kf</h1>
<div class="lead">Learn to run and maintain Kf as a platform.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-676fe26aec89a6298c30c8bde719f98c">Service brokers</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>1.1: <a href="#pg-57a67dff900071f2cffcad23543f9c9e">Service Brokers Overview</a></li>


    
  
    
    
	
<li>1.2: <a href="#pg-9a3de66316708be4c05787cd2dd1aba9">About Kf Cloud Service Broker</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>1.3: <a href="#pg-5446c3e6e9dd77ccf2bb6d4380fbad8c">Deploy Kf Cloud Service Broker</a></li>


    
  
    
    
	
<li>1.4: <a href="#pg-0ed1f2553ce17ae3693a557beaea071d">Set up NFS platform</a></li>


    
  

    </ul>
    
  
    
    
	
<li>2: <a href="#pg-eb59913b8a37858863152c1befc303fb">Customizing Kf</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>2.1: <a href="#pg-b156f3a85a418456ea8aeb7c077af36d">Customizing Overview</a></li>


    
  
    
    
	
<li>2.2: <a href="#pg-2de7bc87b8e461d33fe1259e2cf92256">Cluster Configuration</a></li>


    
  
    
    
	
<li>2.3: <a href="#pg-3c86bc86c018c6665f7e1bad06988b6f">Customizing Kf Features</a></li>


    
  

    </ul>
    
  
    
    
	
<li>3: <a href="#pg-ee9aef4d5863cf3b7971485e6a86039f">Kf dependencies and architecture</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>4: <a href="#pg-835c09d088daa498f7f4edc9aca34410">Kf reference architecture diagrams</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>5: <a href="#pg-84debb8217acd435c5d68f3dcf614a6b">Logging and Monitoring</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>5.1: <a href="#pg-dbee04d71aa54a688f7ea60028e06371">Create and user monitoring dashboards.</a></li>


    
  
    
    
	
<li>5.2: <a href="#pg-5a85a7965fdcfe4cf8ad48fec38d5940">Logging and monitoring</a></li>


    
  
    
    
	
<li>5.3: <a href="#pg-feab5808045e2631f70969b913fafe31">Logging and monitoring overview</a></li>


    
  
    
    
	
<li>5.4: <a href="#pg-ca8fa32dfcb17c91cbd11356f47a4f4f">View logs</a></li>


    
  

    </ul>
    
  
    
    
	
<li>6: <a href="#pg-b2adb428c5ca36c2ceb9e1e03ad76231">Networking</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>6.1: <a href="#pg-7a417b00bb28a3931ab1fd45e7c32f1a">Set up a custom domain</a></li>


    
  
    
    
	
<li>6.2: <a href="#pg-02e4f4812df4620e950d845e9b74bf7c">Set up HTTPS ingress</a></li>


    
  
    
    
	
<li>6.3: <a href="#pg-73a1d3010499b813fad95f898bb1d8a8">Set up network policies</a></li>


    
  

    </ul>
    
  
    
    
	
<li>7: <a href="#pg-cbe31da3743a949ac1b65626af3b367b">Security</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>7.1: <a href="#pg-618739ac86f5ed17603f48ea81584abf">Security Overview</a></li>


    
    <ul>
        
  
  
  
  

  

    </ul>
    
  
    
    
	
<li>7.2: <a href="#pg-304425574fd6e3f21a7dd1619983268f">Role-based access control</a></li>


    
  
    
    
	
<li>7.3: <a href="#pg-40ff7467b86eb5796edbb4944e3340fe">Configure role-based access control</a></li>


    
  
    
    
	
<li>7.4: <a href="#pg-4497b76abb619113621471039e747061">Enable compute isolation</a></li>


    
  
    
    
	
<li>7.5: <a href="#pg-f4376724fa27ad233014070cf3e62b66">Kubernetes Roles</a></li>


    
  

    </ul>
    
  
    
    
	
<li>8: <a href="#pg-340fae6dd8d6497edae52aa4e6cac4ff">Stacks and Buildpacks</a></li>


    
    <ul>
        
  
  
  
  

  
    
    
	
<li>8.1: <a href="#pg-6dc2637a3c7511c15b5eea65056a667c">Customize stacks</a></li>


    
  
    
    
	
<li>8.2: <a href="#pg-7b5d652a95409ea35a6e10e2bce40600">Customize stacks and buildpacks</a></li>


    
  

    </ul>
    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-676fe26aec89a6298c30c8bde719f98c">1 - Service brokers</h1>
    <div class="lead">Learn to install and operate backing service marketplaces for Kf.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-57a67dff900071f2cffcad23543f9c9e">1.1 - Service Brokers Overview</h1>
    
	<p>Kf supports binding and provisioning apps to <a href="https://www.openservicebrokerapi.org/">Open Service Broker (OSB)</a> services.</p>
<p>Any compatible service broker can be installed using the <code>create-service-broker</code> command, but only the <a href="/docs/v2.11/operator/service-brokers/cloud-sb-overview/">Kf Cloud Service Broker</a> is fully supported.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Kf only supports a subset of the types of services
that Open Service Brokers provide. Specifically, it only supports credential
services.
</aside>

<p>Special services such as syslog drains, volume services, route services,
service keys, and shared services aren&rsquo;t currently supported.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9a3de66316708be4c05787cd2dd1aba9">1.2 - About Kf Cloud Service Broker</h1>
    
	<p>The Kf Cloud Service Broker is a Service Broker bundle that includes the open source
<a href="https://github.com/cloudfoundry-incubator/cloud-service-broker">Cloud Service Broker</a>
and <a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp">Google Cloud Brokerpak</a>.
It is made available as a public Docker image and ready to deploy as a
Kubernetes service in Kf clusters. Once the
Kf Cloud Service Broker service is deployed in a cluster, developers can provision Google Cloud
backing services through the Kf Cloud Service Broker service, and bind the backing services to Kf Apps.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Kf Cloud Service Brokeris not customizable, and the default
Google Cloud Brokerpak is included. If you would like to use a custom
Brokerpak, you can follow the steps in the
<a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp/blob/main/docs/gcp-installation.md">open source Cloud Service Broker Google Cloud installation guide</a>.
</aside>

<h2 id="requirements">Requirements</h2>
<ul>
<li>Kf Cloud Service Broker requires a MySQL instance and a service account for accessing the MySQL instance and Google Cloud backing services to be provisioned. Connection from the Kf Cloud Service Broker to the MySQL instance goes through the <a href="https://cloud.google.com/sql/docs/mysql/sql-proxy">Cloud SQL Auth Proxy</a>.</li>
<li>Requests to access Google Cloud services (for example: Cloud SQL for MySQL or Cloud Memorystore for Redis) are authenticated via <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity">Workload Identity</a>.</li>
</ul>
<h2 id="override-brokerpak-defaults">Override Brokerpak defaults</h2>
<p>Brokerpaks are essentially a Terraform plan and related dependencies in a tar
file. You can inspect the Terraform plans to see what the defaults are, and then
you can tell Kf Cloud Service Broker to override them when creating new services.</p>
<p>For example, the <a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp/blob/main/terraform/cloud-sql-provision.tf">Terraform plan for MySQL</a> includes a variable called <code>authorized_network</code>. If not overridden, the <code>default</code> VPC will be used. If you&rsquo;d like to override the default, you can pass that during service creation. Here are some examples:</p>
<ol>
<li>Override the compute region <code>config</code>.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> kf create-service csb-google-postgres small spring-music-postgres-db -c <span style="color:#4e9a06">&#39;{&#34;config&#34;:&#34;YOUR_COMPUTE_REGION&#34;}&#39;</span>
</span></span></code></pre></div><ol>
<li>Override the <code>authorized_network</code> and compute region <code>config</code>.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span> kf create-service csb-google-postgres small spring-music-postgres-db -c <span style="color:#4e9a06">&#39;{&#34;config&#34;:&#34;YOUR_COMPUTE_REGION&#34;,&#34;authorized_network&#34;:&#34;YOUR_CUSTOM_VPC_NAME&#34;}&#39;</span>
</span></span></code></pre></div><p>You can learn more by reading the <a href="https://github.com/cloudfoundry-incubator/csb-brokerpak-gcp/blob/main/docs/mysql-plans-and-config.md">MySQL Plans and Configs</a> documentation.</p>
<h2 id="architecture">Architecture</h2>
<p>The following Kf Cloud Service Broker architecture shows how instances are created.</p>

<figure>
    <img src="./kf-csb-architecture.svg"
         alt="Kf Cloud Service Broker architecture"/> 
</figure>

<ul>
<li>The Kf Cloud Service Broker (CSB) is installed in its own namespace.</li>
<li>On installation, a MySQL instance must be provided to persist
business logic used by Kf Cloud Service Broker. Requests are sent securely
from the Kf Cloud Service Broker pod to the MySQL instance via
the MySQL Auth Proxy.</li>
<li>On service provisioning, a Kf Service custom resource
is created. The reconciler of the Kf Service
provisions Google Cloud backing services using the Open Service Broker API.</li>
<li>When a request to provision/deprovision backing resources is received,
Kf Cloud Service Broker sends resource creation/deletion requests to the
corresponding Google Cloud service, and these requests are authenticated
with Workload Identity. It also persists the business logics (e.g. mapping of
Kf services to backing services, service bindings) to
the MySQL instance.</li>
<li>On backing service creation success, the backing service is bound to an App
via <a href="/docs/v2.11/developer/build-and-deploy/app-runtime/#vcapservices">VCAP_SERVICES</a>.</li>
</ul>
<h2 id="whats-next">What&rsquo;s next?</h2>
<ul>
<li><a href="/docs/v2.11/operator/service-brokers/deploying-cloud-sb/">Deploy Kf Cloud Service Broker</a>.</li>
<li><a href="/docs/v2.11/developer/backing-services/managed-services/">Learn how to list and provision services</a>.</li>
</ul>
<p>{% endblock %}</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5446c3e6e9dd77ccf2bb6d4380fbad8c">1.3 - Deploy Kf Cloud Service Broker</h1>
    
	<p>This page shows you how to deploy Kf Cloud Service Broker and use it to provision or deprovision backing resources.
Read about the <a href="/docs/v2.11/operator/service-brokers/cloud-sb-overview/">concepts and architecture</a> to learn more about the Kf Cloud Service Broker.</p>
<h2 id="create_env_variables">Create environment variables</h2>
<ul>
<li>
<p><strong>Linux</strong></p>
<pre class="devsite-click-to-copy" translate="no">
export PROJECT_ID=<var>YOUR_PROJECT_ID</var>
export CLUSTER_PROJECT_ID=<var>YOUR_PROJECT_ID</var>
export CLUSTER_NAME=<var>kf-cluster</var>
export INSTANCE_NAME=<var>cloud-service-broker</var>
export COMPUTE_REGION=<var>us-central1</var>
</pre>
</li>
<li>
<p><strong>Windows PowerShell</strong></p>
<pre class="devsite-click-to-copy" translate="no">
Set-Variable -Name PROJECT_ID -Value <var>YOUR_PROJECT_ID</var>
Set-Variable -Name CLUSTER_PROJECT_ID -Value <var>YOUR_PROJECT_ID</var>
Set-Variable -Name CLUSTER_NAME -Value <var>kf-cluster</var>
Set-Variable -Name INSTANCE_NAME -Value <var>cloud-service-broker</var>
Set-Variable -Name COMPUTE_REGION -Value <var>us-central1</var>
</pre>
</li>
</ul>
<h2 id="set-up-the-kf-cloud-service-broker-database">Set up the Kf Cloud Service Broker database</h2>
<ol>
<li>
<p>Create a MySQL instance.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> <pre><code>Read [Creating and managing MySQL users](https://cloud.google.com/sql/docs/mysql/create-manage-users) for Google Cloud SQL and set a secure password for the default `root` user.
</code></pre>

</aside>

<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gcloud sql instances create <span style="color:#4e9a06">${</span><span style="color:#000">INSTANCE_NAME</span><span style="color:#4e9a06">}</span> --cpu<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">2</span> --memory<span style="color:#ce5c00;font-weight:bold">=</span>7680MB --require-ssl --region<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">${</span><span style="color:#000">COMPUTE_REGION</span><span style="color:#4e9a06">}</span>
</span></span></code></pre></div></li>
<li>
<p>Create a database named <code>servicebroker</code> in the MySQL instance.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Document the database name since it is used in later steps.
</aside>

<pre class="devsite-click-to-copy" translate="no">
gcloud sql databases create servicebroker -i ${INSTANCE_NAME}</pre>
</li>
<li>
<p>Create a username and password to be used by the broker.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Document these values since they will be used in later steps.
</aside>

<pre class="devsite-click-to-copy" translate="no">
gcloud sql users create <var>csbuser</var> -i ${INSTANCE_NAME} --password=<var>csbpassword</var></pre>
</li>
</ol>
<h2 id="set-up-a-google-service-account-for-the-broker">Set up a Google Service Account for the broker</h2>
<ol>
<li>Create a Google Service Account.</li>
</ol>
  <pre class="devsite-click-to-copy" translate="no">
  gcloud iam service-accounts create csb-${CLUSTER_NAME}-sa \
      --project=${CLUSTER_PROJECT_ID} \
      --description="GSA for CSB at ${CLUSTER_NAME}" \
      --display-name="csb-${CLUSTER_NAME}"</pre>
<ol>
<li>Grant <code>roles/cloudsql.client</code> permissions to the Service Account. This is required to connect the service broker pod to the CloudSQL for MySQL instance through the CloudSQL Proxy.</li>
</ol>
  <pre class="devsite-click-to-copy" translate="no">
  gcloud projects add-iam-policy-binding ${CLUSTER_PROJECT_ID} \
      --member="serviceAccount:csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com" \
      --role="roles/cloudsql.client"</pre>
<ol>
<li>Grant additional Google Cloud permissions to the Service Account.</li>
</ol>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> In the example below, we grant IAM roles required to provision an instance of CloudSQL and Cloud Memorystore.
You must grant this service account the appropriate roles to provision instances of other Google Cloud managed services listed in <code>kf marketplace</code>.
</aside>

  <pre class="devsite-click-to-copy" translate="no">
  gcloud projects add-iam-policy-binding ${CLUSTER_PROJECT_ID} \
      --member="serviceAccount:csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com" \
      --role="roles/compute.networkUser"</pre>
  <pre class="devsite-click-to-copy" translate="no">
  gcloud projects add-iam-policy-binding ${CLUSTER_PROJECT_ID} \
      --member="serviceAccount:csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com" \
      --role="roles/cloudsql.admin"</pre>
  <pre class="devsite-click-to-copy" translate="no">
  gcloud projects add-iam-policy-binding ${CLUSTER_PROJECT_ID} \
      --member="serviceAccount:csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com" \
      --role="roles/redis.admin"</pre>
<ol>
<li>Verify the permissions.</li>
</ol>

<aside class="alert alert-danger" style="border-width: 1px 1px 1px 4px;">
<i class="fa-solid fa-triangle-exclamation"></i> <strong>Warning:</strong> Replace the <code>CSB_SERVICE_ACCOUNT_NAME</code> variable in the YAML below with the full service account resolved from <code>csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com</code>.
</aside>


  <pre class="devsite-click-to-copy" translate="no">
  gcloud projects get-iam-policy ${CLUSTER_PROJECT_ID} \
      --filter='bindings.members:serviceAccount:"<var>CSB_SERVICE_ACCOUNT_NAME</var>"' \
      --flatten="bindings[].members"</pre>
<h2 id="set-up-workload-identity-for-the-broker">Set up Workload Identity for the broker</h2>
<ol>
<li>Bind the Google Service Account with the Kubernetes Service Account.</li>
</ol>
  <pre class="devsite-click-to-copy" translate="no">
  gcloud iam service-accounts add-iam-policy-binding "csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com" \
      --project=${CLUSTER_PROJECT_ID} \
      --role="roles/iam.workloadIdentityUser" \
      --member="serviceAccount:${CLUSTER_PROJECT_ID}.svc.id.goog[kf-csb/csb-user]"</pre>
<ol>
<li>Verify the binding.</li>
</ol>
  <pre class="devsite-click-to-copy" translate="no">
  gcloud iam service-accounts get-iam-policy "csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com" \
      --project=${CLUSTER_PROJECT_ID}</pre>
<h2 id="kubernetes_secret">Set up a Kubernetes Secret to share configuration with the broker</h2>
<ol>
<li>Create a config.yml file.</li>
</ol>
<p>Note: Replace the default user/password if desired. Ensure you have set the <code>CLUSTER_PROJECT_ID</code> in the <a href="#create_env_variables">Create environment variables</a> step.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>cat <span style="color:#4e9a06">&lt;&lt; EOF &gt;&gt; ./config.yml
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">gcp:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  credentials: &#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  project: ${CLUSTER_PROJECT_ID}
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">db:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  host: 127.0.0.1
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  password: csbpassword
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  user: csbuser
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  tls: false
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">api:
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  user: servicebroker
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">  password: password
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">EOF</span>
</span></span></code></pre></div><ol>
<li>Create the <code>kf-csb</code> namespace.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl create ns kf-csb
</span></span></code></pre></div><ol>
<li>Create the Kubernetes Secret.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl create secret generic csb-secret --from-file<span style="color:#ce5c00;font-weight:bold">=</span>config.yml -n kf-csb
</span></span></code></pre></div><h2 id="install-the-kf-cloud-service-broker">Install the Kf Cloud Service Broker</h2>
<ol>
<li>Download the <code>kf-csb.yml</code>.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gsutil cp gs://kf-releases/csb/v<span style="color:#ce5c00;font-weight:bold">{{</span>this_kf_csb_version<span style="color:#ce5c00;font-weight:bold">}}</span>/kf-csb.yaml /tmp/kf-csb.yaml
</span></span></code></pre></div><ol>
<li>Edit <code>/tmp/kf-csb.yaml</code> and replace placeholders with final values. In the example below, <code>sed</code> is used.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sed -i <span style="color:#4e9a06">&#34;s|&lt;GSA_NAME&gt;|csb-</span><span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">-sa@</span><span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_PROJECT_ID</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">.iam.gserviceaccount.com|g&#34;</span> /tmp/kf-csb.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#4e9a06">&#34;s|&lt;INSTANCE_CONNECTION_NAME&gt;|</span><span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_PROJECT_ID</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">:</span><span style="color:#4e9a06">${</span><span style="color:#000">COMPUTE_REGION</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">:</span><span style="color:#4e9a06">${</span><span style="color:#000">INSTANCE_NAME</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">|g&#34;</span> /tmp/kf-csb.yaml
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sed -i <span style="color:#4e9a06">&#34;s|&lt;DB_PORT&gt;|3306|g&#34;</span> /tmp/kf-csb.yaml
</span></span></code></pre></div><ol>
<li>Apply yaml for Kf Cloud Service Broker.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl apply -f /tmp/kf-csb.yaml
</span></span></code></pre></div><ol>
<li>Verify the Cloud Service Broker installation status.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get pods -n kf-csb
</span></span></code></pre></div><h2 id="create-a-service-broker">Create a service broker</h2>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> The user/password must match what you entered in the <a href="#kubernetes_secret">Kubernetes secret</a> step earlier.
</aside>

<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf create-service-broker cloud-service-broker servicebroker password http://csb-controller.kf-csb/
</span></span></code></pre></div><h2 id="validate-installation">Validate installation</h2>
<p>Check for available services in the marketplace.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf marketplace
</span></span></code></pre></div><p>If everything is installed and configured correctly, you should see the following:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">$ kf marketplace

Broker                Name                          Namespace  Description
cloud-service-broker  csb-google-bigquery                      A fast, economical and fully managed data warehouse for large-scale data analytics.
cloud-service-broker  csb-google-dataproc                      Dataproc is a fully-managed service for running Apache Spark and Apache Hadoop clusters in a simpler, more cost-efficient way.
cloud-service-broker  csb-google-mysql                         Mysql is a fully managed service for the Google Cloud Platform.
cloud-service-broker  csb-google-postgres                      PostgreSQL is a fully managed service for the Google Cloud Platform.
cloud-service-broker  csb-google-redis                         Cloud Memorystore for Redis is a fully managed Redis service for the Google Cloud Platform.
cloud-service-broker  csb-google-spanner                       Fully managed, scalable, relational database service for regional and global application data.
cloud-service-broker  csb-google-stackdriver-trace             Distributed tracing service
cloud-service-broker  csb-google-storage-bucket                Google Cloud Storage that uses the Terraform back-end and grants service accounts IAM permissions directly on the bucket.
</code></pre><h2 id="clean-up">Clean up</h2>
<ol>
<li>Delete cloud-service-broker.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf delete-service-broker cloud-service-broker
</span></span></code></pre></div><ol>
<li>Delete CSB components.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl delete ns kf-csb
</span></span></code></pre></div><ol>
<li>
<p>Delete the broker&rsquo;s database instance.</p>
 <pre class="devsite-click-to-copy" translate="no">
 gcloud sql instances delete ${INSTANCE_NAME} --project=${CLUSTER_PROJECT_ID}</pre>
</li>
<li>
<p>Remove the IAM policy bindings.</p>
 <pre class="devsite-click-to-copy" translate="no">
 gcloud projects remove-iam-policy-binding ${CLUSTER_PROJECT_ID} \
 --member='serviceAccount:csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com' \
 --role=roles/cloudsql.client</pre>
 <pre class="devsite-click-to-copy" translate="no">
 gcloud projects remove-iam-policy-binding ${CLUSTER_PROJECT_ID} \
 --member='serviceAccount:csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com' \
 --role=roles/compute.networkUser</pre>
 <pre class="devsite-click-to-copy" translate="no">
 gcloud projects remove-iam-policy-binding ${CLUSTER_PROJECT_ID} \
 --member='serviceAccount:csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com' \
 --role=roles/redis.admin</pre>
</li>
<li>
<p>Remove the GSA.</p>
 <pre class="devsite-click-to-copy" translate="no">
 gcloud iam service-accounts delete csb-${CLUSTER_NAME}-sa@${CLUSTER_PROJECT_ID}.iam.gserviceaccount.com \
   --project=${CLUSTER_PROJECT_ID}</pre>
</li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0ed1f2553ce17ae3693a557beaea071d">1.4 - Set up NFS platform</h1>
    
	<p>Kf supports Kubernetes native NFS, and exposes them with a dedicated <code>nfsvolumebroker</code> service broker for developers to consume. This broker has an <code>nfs</code> service offering which has a service plan named <code>existing</code>.</p>
<p>Use <code>kf marketplace</code> to see the service offering:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">$ kf marketplace
...
Broker           Name  Namespace  Description
nfsvolumebroker  nfs              mout nfs shares
...
</code></pre><p>Use <code>kf marketplace -s nfs</code> to see the service plan:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">$ kf marketplace -s nfs
...
Broker           Name      Free  Description
nfsvolumebroker  existing  true  mount existing nfs server
...
</code></pre><h2 id="requirements">Requirements</h2>
<p>You need an NFS volume that can be accessed by your Kubernetes cluster. For example <a href="https://cloud.google.com/filestore">Cloud Filestore</a> which Google&rsquo;s managed NFS solution that provides access to clusters in the same gcloud project.</p>
<h2 id="prepare-nfs">Prepare NFS</h2>
<p>If you have an existing NFS service, you can use that. If you want a Google managed NFS service, <a href="https://cloud.google.com/filestore/docs/creating-instances">create a Filestore instance</a> and Kf will automaticlaly configure the cluster to use it.</p>
<p>Warning: You only need to create the NFS instance. Kf will create relevant Kubernetes objects, including PersistentVolume and PersistentVolumeClaims. Do not manually mount the volume.</p>
<h2 id="whats-next">What&rsquo;s next?</h2>
<ul>
<li><a href="/docs/v2.11/developer/backing-services/nfs-getting-started/">Configure NFS volumes</a></li>
</ul>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-eb59913b8a37858863152c1befc303fb">2 - Customizing Kf</h1>
    <div class="lead">Learn about how to configure cluster-wide settings.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-b156f3a85a418456ea8aeb7c077af36d">2.1 - Customizing Overview</h1>
    <div class="lead">Learn about how Kf uses configuration.</div>
	<p>Kf supports customizing some cluster wide configurations by manipulating the <code>kfsystem</code> custom rsource.</p>

<aside class="alert alert-danger" style="border-width: 1px 1px 1px 4px;">
<i class="fa-solid fa-triangle-exclamation"></i> <strong>Warning:</strong> Changes will be instantly pushed to all Kf resources, test any customization options before using them in production.
</aside>



</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-2de7bc87b8e461d33fe1259e2cf92256">2.2 - Cluster Configuration</h1>
    <div class="lead">Learn to configure your Kf cluster&rsquo;s settings.</div>
	
<aside class="alert alert-danger" style="border-width: 1px 1px 1px 4px;">
<i class="fa-solid fa-triangle-exclamation"></i> <strong>Warning:</strong> Changes will be instantly pushed to all Kf resources, test any customization options before using them in production.
</aside>


<p>Kf uses a Kubernetes configmap named <code>config-defaults</code> in
the <code>kf</code> namespace to store cluster wide configuration settings.
This document explains its structure and fields.</p>
<h2 id="structure-of-the-config-defaults-configmap">Structure of the config-defaults configmap</h2>
<p>The configmap contains three types of key/value pairs in the <code>.data</code> field:</p>
<ul>
<li>Comment keys prefixed by <code>_</code> contain examples, notes, and warnings.</li>
<li>String keys contain plain text values.</li>
<li>Object keys contain a JSON or YAML value that has been encoded as a string.</li>
</ul>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">_note</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;This is some note&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">stringKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;This is a string key that&#39;s not encoded as JSON or YAML.&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span><span style="color:#204a87;font-weight:bold">objectKey</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - &#34;These keys contain nested YAML or JSON.&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - true
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - 123.45</span><span style="color:#f8f8f8;text-decoration:underline">  
</span></span></span></code></pre></div>
<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Kubernetes requires all configmap values to be strings.
Kf validates the structure of the fields before the
object is updated.
</aside>

<h2 id="example-section">Example section</h2>
<p>The example section under the <code>_example</code> key contains explanations for other
fields and examples. Changes to this section have no effect.</p>
<h2 id="space-container-registry">Space container registry</h2>
<p>The <code>spaceContainerRegistry</code> property is a plain text value that specifies the
default container registry each space uses to store built images.</p>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spaceContainerRegistry</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">gcr.io/my-project</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="space-cluster-domains">Space cluster domains</h2>
<p>The <code>spaceClusterDomains</code> property is a string encoded YAML array of domain objects.</p>
<p>Each space in the cluster adds all items in the array to its list of
domains that developers can bind their apps to.</p>
<table class="properties responsive">
  <thead>
    <tr>
      <th colspan="2">Fields</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>domain</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>The domain name to make available. May contain one of the following substitutions:</p>
        <ul>
          <li><code>$(SPACE_NAME)</code> - Replaced in each space with the name of the space.</li>
          <li><code>$(CLUSTER_INGRESS_IP)</code> - The IP address of the cluster ingress gateway.</li>
        </ul>
      </td>
    </tr>
    <tr>
      <td><code>gatewayName</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>(Optional)</p>
        <p>
          Overrides the Istio gateway routes will be bound to.
          Defaults to <code>kf/external-gateway</code>, but any
          other gateway in the <code>kf</code> namespace may be used.
        </p>
      </td>
    </tr>
  </tbody>
</table>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> All domains should contain the <code>$(SPACE_NAME)</code> substitution to prevent
Apps in different namespaces from listening to the same hostname which causes
undefined behavior.
</aside>

<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spaceClusterDomains</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  # Support canonical and vanity domains
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - domain: $(SPACE_NAME).prod.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - domain: $(SPACE_NAME).kf.us-east1.prod.example.com
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  # Using a dynamic DNS resolver
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - domain: $(SPACE_NAME).$(CLUSTER_INGRESS_IP).nip.io
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  # Creating an internal domain only visible within the cluster
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - domain: $(SPACE_NAME)-apps.internal
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    gatewayName: kf/internal-gateway</span><span style="color:#f8f8f8;text-decoration:underline">  
</span></span></span></code></pre></div><h2 id="buildpacks-v2-lifecycle-builder">Buildpacks V2 lifecycle builder</h2>
<p>The <code>buildpacksV2LifecycleBuilder</code> property contains the version of the Cloud Foundry
<code>builder</code> binary used execute buildpack v2 builds.</p>
<p>The value is a Git reference. To use a specific version, append an <code>@</code> symbol
followed by a Git SHA to the end.</p>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">buildpacksV2LifecycleBuilder</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;code.cloudfoundry.org/buildpackapplifecycle/builder@GIT_SHA&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="buildpacks-v2-lifecycle-launcher">Buildpacks V2 lifecycle launcher</h2>
<p>The <code>buildpacksV2LifecycleLauncher</code> property contains the version of the Cloud Foundry
<code>launcher</code> binary built into every buildpack V2 application.</p>
<p>The value is a Git reference. To use a specific version, append an <code>@</code> symbol
followed by a Git SHA to the end.</p>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">buildpacksV2LifecycleLauncher</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#4e9a06">&#34;code.cloudfoundry.org/buildpackapplifecycle/launcher@GIT_SHA&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><h2 id="buildpacks-v2-list">Buildpacks V2 list</h2>
<p>The <code>spaceBuildpacksV2</code> property is a string encoded YAML array that holds an ordered
list of default buildpacks that are used to build applications compatible with
the V2 buildpacks process.</p>
<table class="properties responsive">
  <thead>
    <tr>
      <th colspan="2">Fields</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>name</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>A short name developers can use to reference the buildpack by in their application manifests.</p>
      </td>
    </tr>
    <tr>
      <td><code>url</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>The URL used to fetch the buildpack.</p>
      </td>
    </tr>
    <tr>
      <td><code>disabled</code></td>
      <td>
        <p><code class="apitype">boolean</code></p>
        <p>Used to prevent this buildpack from executing.</p>
      </td>
    </tr>
  </tbody>
</table>
<h2 id="stacks-v2-list">Stacks V2 list</h2>
<p>The <code>spaceBuildpacksV2</code> property is a string encoded YAML array that holds an
ordered list of stacks that can be used with Cloud Foundry compatible builds.</p>
<table class="properties responsive">
  <thead>
    <tr>
      <th colspan="2">Fields</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>name</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>A short name developers can use to reference the stack by in their application manifests.</p>
      </td>
    </tr>
    <tr>
      <td><code>image</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>
          URL of the container image to use as the stack.
          For more information, see <a href="https://kubernetes.io/docs/concepts/containers/images">https://kubernetes.io/docs/concepts/containers/images</a>.
        </p>
      </td>
    </tr>
  </tbody>
</table>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Use images tagged with SHAs to improve caching.
</aside>

<h2 id="stacks-v3-list">Stacks V3 list</h2>
<p>The <code>spaceStacksV3</code> property is a string encoded YAML array that holds an ordered
list of stacks that can be used with
<a href="https://buildpacks.io/">Cloud Native Buildpack</a>
builds.</p>
<table class="properties responsive">
  <thead>
    <tr>
      <th colspan="2">Fields</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>name</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>A short name developers can use to reference the stack by in their application manifests.</p>
      </td>
    </tr>
    <tr>
      <td><code>description</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>A short description of the stack shown when running <code>kf stacks</code>.</p>
      </td>
    </tr>
    <tr>
      <td><code>buildImage</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>
          URL of the container image to use as the builder.
          For more information, see <a href="https://kubernetes.io/docs/concepts/containers/images">https://kubernetes.io/docs/concepts/containers/images</a>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>runImage</code></td>
      <td>
        <p><code class="apitype">string</code></p>
        <p>
          URL of the container image to use as the base for all apps built with .
          For more information, see <a href="https://kubernetes.io/docs/concepts/containers/images">https://kubernetes.io/docs/concepts/containers/images</a>.
        </p>
      </td>
    </tr>
    <tr>
      <td><code>nodeSelector</code></td>
      <td>
        <p><code class="apitype">map (key: string, value: string)</code></p>
        <p>(Optional)</p>
        <p>
          A NodeSelector used to indicate which nodes applications built with
          this stack can run on.
        </p>
      </td>
    </tr>
  </tbody>
</table>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Use images tagged with SHAs to improve caching.
</aside>

<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spaceStacksV3</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  - name: heroku-18
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    description: The official Heroku stack based on Ubuntu 18.04
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    buildImage: heroku/pack:18-build
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    runImage: heroku/pack:18
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">    nodeSelector:
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">       kubernetes.io/os: windows</span><span style="color:#f8f8f8;text-decoration:underline">  
</span></span></span></code></pre></div><h2 id="default-to-v3-stack">Default to V3 Stack</h2>
<p>The <code>spaceDefaultToV3Stack</code> property contains a quoted value <code>true</code> or <code>false</code>
indicating whether spaces should use V3 stacks if a user doesn&rsquo;t specify one.</p>
<h2 id="feature-flags">Feature flags</h2>
<p>The <code>featureFlags</code> property contains a string encoded YAML map of feature flags
that can enable and disable features of Kf.</p>
<p>Flag names that aren&rsquo;t supported by Kf will be ignored.</p>
<table>
<thead>
<tr>
<th>Flag Name</th>
<th>Default</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>disable_custom_builds</code></td>
<td><code>false</code></td>
<td>Disable developer access to arbitrary Tekton build pipelines.</td>
</tr>
<tr>
<td><code>enable_dockerfile_builds</code></td>
<td><code>true</code></td>
<td>Allow developers to build source code from dockerfiles.</td>
</tr>
<tr>
<td><code>enable_custom_buildpacks</code></td>
<td><code>true</code></td>
<td>Allow developers to specify external buildpacks in their applications.</td>
</tr>
<tr>
<td><code>enable_custom_stacks</code></td>
<td><code>true</code></td>
<td>Allow developers to specify custom stacks in their applications.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">featureFlags</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000;font-weight:bold">|</span><span style="color:#8f5902;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  disable_custom_builds: false
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  enable_dockerfile_builds: true
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">  enable_some_feature: true</span><span style="color:#f8f8f8;text-decoration:underline">  
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-3c86bc86c018c6665f7e1bad06988b6f">2.3 - Customizing Kf Features</h1>
    <div class="lead">Learn to configure your Kf cluster&rsquo;s settings.</div>
	
<aside class="alert alert-danger" style="border-width: 1px 1px 1px 4px;">
<i class="fa-solid fa-triangle-exclamation"></i> <strong>Warning:</strong> Changes will be instantly pushed to all Kf resources, test any customization options before using them in production.
</aside>


<h2 id="build-retention">Build Retention</h2>
<p>You can control how many Kf Builds are kept before being garbage collected.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> This example sets the retention to 1 Build. Change the value as needed.
</aside>

<pre class="devsite-terminal devsite-click-to-copy" translate="no">
kubectl patch \
kfsystem kfsystem \
--type='json' \
-p="[{'op': 'replace', 'path': '/spec/kf/config/buildRetentionCount', 'value': <var>1</var>}]"
</pre>
<h2 id="enable-or-disable-the-istio-sidecar">Enable or Disable the Istio Sidecar</h2>
<p>If you do not require the Istio sidecar for the Build pods, then they can be disabled by setting the value to <code>true</code>. Enable by setting the value to <code>false</code>.</p>
<pre class="devsite-terminal devsite-click-to-copy" translate="no">
kubectl patch \
kfsystem kfsystem \
--type='json' \
-p="[{'op': 'replace', 'path': '/spec/kf/config/buildDisableIstioSidecar', 'value': <var>true</var>}]"
</pre>
<h2 id="build-pod-resource-limits">Build Pod Resource Limits</h2>
<p>The default pod resource size can be increased from the default to accommodate very large builds. The units for the value are in <code>Mi</code> or <code>Gi</code>.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> This is only applicable for built-in Tasks (which is normal for a <code>kf push</code> build). For V2 buildpack builds, this will be set on two steps and one for V3 buildpacks or Dockerfiles. This means that for a V2 build the required Pod size will be double the limit. For example, if the memory limit is 1Gi, then the pod will require 2Gi.
</aside>

<pre class="devsite-terminal devsite-click-to-copy" translate="no">
kubectl patch \
kfsystem kfsystem \
--type='json' \
-p="[{'op': 'replace', 'path': '/spec/kf/config/buildPodResources', 'value': {'limits': {'memory': '<var>234Mi</var>'}}}]"
</pre>
<p>Read <a href="https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/">Kubernetes container resource docs</a>  for more information about container resource management.</p>
<h2 id="self-signed-certificates-for-service-brokers">Self Signed Certificates for Service Brokers</h2>
<p>If you want to use self signed certificates for TLS (<code>https</code> instead of <code>http</code>) for the service broker URL, the Kf controller requires the CA certificate. To configure Kf for this scenario, create an immutable Kubernetes secret in the <code>kf</code> namespace and update the <code>kfsystem.spec.kf.config.secrets.controllerCACerts.name</code> object to point to it.</p>
<ol>
<li>
<p>Create a secret to store the self-signed certificate.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Customize the secret name if desired, or leave the default name of <code>cacerts</code>. Replace <code>/path/to/cert/certs.pem</code> with the path to the self-signed certificate.
</aside>

 <pre class="devsite-terminal devsite-click-to-copy" translate="no">
 kubectl create secret generic <var>cacerts</var> -nkf --from-file <var>/path/to/cert/certs.pem</var>
 </pre>
</li>
<li>
<p>Make the secret immutable.</p>
 <pre class="devsite-terminal devsite-click-to-copy" translate="no">
 kubectl patch -nkf secret <var>cacerts</var> \
     --type='json' \
     -p="[{'op':'add','path':'/immutable','value':true}]"
 </pre>
</li>
<li>
<p>Update kfsystem to point to the secret.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> This will cause the controller pod to be re-deployed with the certs mounted as a volume.
</aside>

<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl patch <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  kfsystem kfsystem <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --type<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;json&#39;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  -p<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;[{&#39;op&#39;:&#39;add&#39;,&#39;path&#39;:&#39;/spec/kf/config/secrets&#39;,&#39;value&#39;:{&#39;controllerCACerts&#39;:{&#39;name&#39;:&#39;&lt;var&gt;cacerts&lt;/var&gt;&#39;}}}]&#34;</span>
</span></span></code></pre></div></li>
</ol>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ee9aef4d5863cf3b7971485e6a86039f">3 - Kf dependencies and architecture</h1>
    
	<p>Kf requires Kubernetes and several other OSS projects to
run. Some of the dependencies are satisfied with Google-managed services—for
example, GKE provides Kubernetes.</p>
<h2 id="dependencies">Dependencies</h2>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/release-notes">GKE</a></li>
<li><a href="https://cloud.google.com/service-mesh/docs">Anthos Service Mesh</a></li>
<li><a href="https://github.com/tektoncd/pipeline">Tekton Pipelines</a></li>
</ul>

<figure>
    <img src="./kf-components-diagram.svg"
         alt="Diagram showing how Kf components interact."/> 
</figure>

<h2 id="get-crd-details">Get CRD details</h2>
<p>Kf supports the <code>kubectl</code>  subcommand <code>explain</code>. It allows you to list the fields in Kf CRDs to understand how to create Kf objects via automation instead of manually via the CLI. This command is designed to be used with <a href="https://github.com/GoogleContainerTools/kpt-config-sync">ConfigSync</a> to automate creation and management of resources like Spaces across many clusters. You can use this against any of the <a href="#components">component <code>kinds</code> below</a>.</p>
<p>In this example, we examine the <code>kind</code> called <code>space</code> in the <code>spaces</code> CRD:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl explain space.spec
</span></span></code></pre></div><p>The output looks similar to this:</p>
<pre tabindex="0"><code>$ kubectl explain space.spec
KIND:     Space
VERSION:  kf.dev/v1alpha1

RESOURCE: spec &lt;Object&gt;

DESCRIPTION:
     SpaceSpec contains the specification for a space.

FIELDS:
   buildConfig  &lt;Object&gt;
     BuildConfig contains config for the build pipelines.

   networkConfig        &lt;Object&gt;
     NetworkConfig contains settings for the space&#39;s networking environment.

   runtimeConfig        &lt;Object&gt;
     RuntimeConfig contains settings for the app runtime environment.
</code></pre><h2 id="components">Kf components</h2>
<p>Kf installs several of its own Kubernetes
<a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/">custom resources</a>
and <a href="https://kubernetes.io/docs/concepts/workloads/controllers/">controllers</a>.
The custom resources effectively serve as the Kf API and
are used by the <code>kf</code> CLI to interact with the system. The controllers use
Kf&rsquo;s CRDs to orchestrate the other components in the
system.</p>
<p>You can view the CRDs installed and used by Kf by running
the following command:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl api-resources --api-group<span style="color:#ce5c00;font-weight:bold">=</span>kf.dev
</span></span></code></pre></div><p>The output of that command is as follows:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">NAME                      SHORTNAMES   APIGROUP   NAMESPACED   KIND
apps                                   kf.dev     true         App
builds                                 kf.dev     true         Build
clusterservicebrokers                  kf.dev     false        ClusterServiceBroker
routes                                 kf.dev     true         Route
servicebrokers                         kf.dev     true         ServiceBroker
serviceinstancebindings                kf.dev     true         ServiceInstanceBinding
serviceinstances                       kf.dev     true         ServiceInstance
spaces                                 kf.dev     false        Space
</code></pre><h3 id="apps">Apps</h3>
<p>Apps represent a <a href="https://12factor.net/">twelve-factor application</a>
deployed to Kubernetes. They encompass source code, configuration, and the
current state of the application. Apps are responsible for reconciling:</p>
<ul>
<li>Kf Builds</li>
<li>Kf Routes</li>
<li>Kubernetes Deployments</li>
<li>Kubernetes Services</li>
<li>Kubernetes ServiceAccounts</li>
<li>Kubernetes Secrets</li>
</ul>
<p>You can list Apps using Kf or <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf apps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get apps -n space-name
</span></span></code></pre></div><h3 id="builds">Builds</h3>
<p>Builds combine the source code and build configuration for Apps. They provision
Tekton TaskRuns with the correct steps to actuate a Buildpack V2, Buildpack V3,
or Dockerfile build.</p>
<p>You can list Builds using Kf or <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf builds
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get builds -n space-name
</span></span></code></pre></div><h3 id="clusterservicebrokers">ClusterServiceBrokers</h3>
<p>ClusterServiceBrokers hold the connection information necessary to extend
Kf with a service broker. They are responsible for
fetching the catalog of services the broker provides and displaying them in
the output of <code>kf marketplace</code>.</p>
<p>You can list ClusterServiceBrokers using <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get clusterservicebrokers
</span></span></code></pre></div><h3 id="routes">Routes</h3>
<p>Routes are a high level structure that contain HTTP routing rules. They are
responsible for reconciling Istio VirtualServices.</p>
<p>You can list Routes using Kf or <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf routes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get routes -n space-name
</span></span></code></pre></div><h3 id="servicebrokers">ServiceBrokers</h3>
<p>ServiceBrokers hold the connection information necessary to extend
Kf with a service broker. They are responsible for
fetching the catalog of services the broker provides and displaying them in
the output of <code>kf marketplace</code>.</p>
<p>You can list ServiceBrokers using <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl get servicebrokers -n space-name
</span></span></code></pre></div><h3 id="serviceinstancebinding">ServiceInstanceBinding</h3>
<p>ServiceInstanceBindings hold the parameters to create a binding on a service
broker and the credentials the broker returns for the binding. They are
responsible for calling the bind API on the broker to bind the service.</p>
<p>You can list ServiceInstanceBindings using Kf or <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf bindings
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get serviceinstancebindings -n space-name
</span></span></code></pre></div><h3 id="serviceinstance">ServiceInstance</h3>
<p>ServiceInstances hold the parameters to create a service on a service broker.
They are responsible for calling the provision API on the broker to create the
service.</p>
<p>You can list ServiceInstances using Kf or <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf services
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get serviceinstances -n space-name
</span></span></code></pre></div><h3 id="spaces">Spaces</h3>
<p>Spaces hold configuration information similar to Cloud Foundry organizations and
spaces. They are responsible for:</p>
<ul>
<li>Creating the Kubernetes Namespace that other Kf resources are provisioned into.</li>
<li>Creating Kubernetes NetworkPolicies to enforce network connection policies.</li>
<li>Holding configuration and policy for Builds, Apps, and Routes.</li>
</ul>
<p>You can list Spaces using Kf or <code>kubectl</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf spaces
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get spaces
</span></span></code></pre></div><h2 id="kf-rbac--permissions">Kf RBAC / Permissions</h2>
<p>The following sections list permissions for Kf and its
components to have correct access at the cluster level.
These permissions are required and enabled by default in Kf; do
not attempt to disable them.</p>
<table>
  <thead>
  <tr>
  <th><strong>Components</strong></th>
  <th><strong>Namespace</strong></th>
  <th><strong>Service Account</strong></th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td><code>controller</code></td>
  <td>kf</td>
  <td>controller</td>
  <tr>
  <td><code>subresource-apiserver</code></td>
  <td>kf</td>
  <td>controller</td>
  </tr>
  <tr>
  <td><code>webhook</code></td>
  <td>kf</td>
  <td>controller</td>
  </tr>
  <tr>
  <td><code>appdevexperience-operator</code></td>
  <td>appdevexperience</td>
  <td>appdevexperience-operator</td>
  </tr>
  </tbody>
</table>
<p>Note that the <code>appdevexperience-operator</code> service account has the same set of
permissions as <code>controller</code>. The operator is what deploys all Kf
components, including custom resource definitions and controllers.</p>
<h3 id="rbac-for-kf-service-accounts">RBAC for Kf service accounts</h3>
<p>The following <code>apiGroup</code> definitions detail which access control
permissions components in {{product_name}} have on which API groups and resources for both the <code>controller</code>
and <code>appdevexperience-operator</code> service accounts.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;authentication.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">tokenreviews</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;authorization.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">subjectaccessreviews</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">pods</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">services</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">persistentvolumeclaims</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">persistentvolumes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">endpoints</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">events</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">configmaps</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">secrets</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">services</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">services/status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;apps&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">deployments</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">daemonsets</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">replicasets</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">statefulsets</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;apps&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">deployments/finalizers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;rbac.authorization.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">clusterroles</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">roles</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">clusterrolebindings</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">rolebindings</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">escalate</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">deletecollection</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">bind</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;apiregistration.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">apiservices</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;pubsub.cloud.google.com&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">topics </span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">topics/status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">namespaces</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">namespaces/finalizers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">serviceaccounts</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;autoscaling&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">horizontalpodautoscalers</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;coordination.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">leases</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;batch&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">jobs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">cronjobs</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">deletecollection</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;messaging.cloud.google.com&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">channels</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;pubsub.cloud.google.com&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">pullsubscriptions</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;pubsub.cloud.google.com&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000;font-weight:bold">[</span><span style="color:#000">pullsubscriptions/status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;events.cloud.google.com&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;keda.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;admissionregistration.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">mutatingwebhookconfigurations</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">validatingwebhookconfigurations</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;extensions&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">ingresses</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">ingresses/status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span>*<span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">endpoints/restricted</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;certificates.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">certificatesigningrequests</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">certificatesigningrequests/approval</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">certificatesigningrequests/status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;apiextensions.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">customresourcedefinitions</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">   
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;networking.k8s.io&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">networkpolicies</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">create</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">delete</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">deletecollection</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">nodes</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">get</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">list</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">watch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">update</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline"></span>- <span style="color:#204a87;font-weight:bold">apiGroups</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#4e9a06">&#34;&#34;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">resources</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">nodes/status</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">verbs</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> 
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#000">patch</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>The following table lists how the RBAC permissions are used in Kf,
where:</p>
<ul>
<li><strong>view</strong> includes the verbs: get, list, watch</li>
<li><strong>modify</strong> includes the verbs: create, update, delete, patch</li>
</ul>
<table>
  <thead>
  <tr>
  <th><strong>Permissions</strong></th>
  <th><strong>Reasons</strong></th>
  </tr>
  </thead>
  <tbody>
  <tr>
  <td>Can view all <code>secrets</code></td>
  <td>Kf reconcilers need to read secrets for functionalities such as space creation and service instance binding.</td>
  <tr>
  <td>Can modify <code>pods</code></td>
  <td>Kf reconcilers need to modify pods for functionalities such as building/pushing Apps and Tasks.</td>
  </tr>
  <tr>
  <td>Can modify <code>secrets</code></td>
  <td>Kf reconcilers need to modify secrets for functionalities such as building/pushing Apps and Tasks and service instance binding.</td>
  </tr>
  <tr>
  <td>Can modify <code>configmaps</code></td>
  <td>Kf reconcilers need to modify configmaps for functionalities such as building/pushing Apps and Tasks.</td>
  </tr>
  <tr>
  <td>Can modify <code>endpoints</code></td>
  <td>Kf reconcilers need to modify endpoints for functionalities such as building/pushing Apps and route binding.</td>
  </tr>
  <tr>
  <td>Can modify <code>services</code></td>
  <td>Kf reconcilers need to modify pods for functionalities such as building/pushing Apps and route binding.</td>
  </tr>
  <tr>
  <td>Can modify <code>events</code></td>
  <td>Kf controller creates and emits events for the resources
    managed by Kf.</td>
  </tr>
  <tr>
  <td>Can modify <code>serviceaccounts</code></td>
  <td>Kf needs to modify service accounts for App deployments.</td>
  </tr>
  <tr>
  <td>Can modify <code>endpoints/restricted</code></td>
  <td>Kf needs to modify endpoints for App deployments.</td>
  </tr>
  <tr>
  <td>Can modify <code>deployments</code></td>
  <td>Kf needs to modify deployments for functionalities such as pushing Apps.</td>
  </tr>
  <tr>
  <td>Can modify <code>mutatingwebhookconfiguration</code></td>
  <td>Mutatingwebhookconfiguration is needed by {{mesh_name}}, a Kf dependency, for admission webhooks.</td>
  </tr>
  <tr>
  <td>Can modify
    <code>customresourcedefinitions customresourcedefinitions/status</code></td>
  <td>Kf manages resources through Custom Resources such as Apps, Spaces and Builds.</td>
  </tr>
  <tr>
  <td>Can modify <code>horizontalpodautoscalers</code></td>
  <td>Kf supports autoscaling based on Horizontal Pod Autoscalers.</td>
  </tr>
  <tr>
  <td>Can modify <code>namespace/finalizer</code></td>
  <td>Kf needs to set owner reference of webhooks.</td>
  </tr>
  </tbody>
</table>
<h2 id="third_party_libraries">Third-party libraries</h2>
<p>Third-party library source code and licenses can be found in the <code>/third_party</code>
directory of any Kf container image.</p>
<p>You can also run <code>kf third-party-licenses</code> to view the third-party licenses for
the version of the Kf CLI that you downloaded.</p>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-835c09d088daa498f7f4edc9aca34410">4 - Kf reference architecture diagrams</h1>
    <div class="lead">Learn about common ways of deploying and managing Kf clusters.</div>
	<p>Kf can benefit from the rich ecosystem of Anthos and GKE, including automation, managed backing services, and development tools.</p>
<h2 id="gke-reference-architecture">GKE reference architecture</h2>
<p>Kf clusters are managed just like any other GKE cluster, and access resources in the same way.</p>

<figure>
    <img src="./gke-reference-diagram.svg"
         alt="GKE and Kf cluster architecture."/> 
</figure>

<h2 id="configsync">ConfigSync</h2>
<p>Kf can work with
<a href="https://github.com/GoogleContainerTools/kpt-config-sync">ConfigSync</a> to
automate Space creation across any number of clusters.
Create new namespaces on non-Kf clusters, and Spaces on Kf clusters.
You can also manage Spaces by removing the Kf CLI from Space management, if desired. Use <code>kubectl explain</code> to <a href="/docs/v2.11/operator/kf-dependencies/#get_crd_details">get Kf CRD specs</a> to fully manage your product configuration via GitOps.</p>

<figure>
    <img src="./config-sync-reference-diagram.svg"
         alt="Config Sync and Kf cluster architecture."/> 
</figure>


</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-84debb8217acd435c5d68f3dcf614a6b">5 - Logging and Monitoring</h1>
    
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-dbee04d71aa54a688f7ea60028e06371">5.1 - Create and user monitoring dashboards.</h1>
    
	<p>You can use <a href="https://cloud.google.com/monitoring/dashboards">Google Cloud Monitoring dashboards</a> to create custom dashboards and charts. Kf comes with a default template which can be used to create dashboards to monitor the performance of your applications.</p>
<h2 id="application-performance-dashboard">Application performance dashboard</h2>
<p>Run the following commands to deploy a dashboard in your monitoring workspace in <a href="https://cloud.google.com/monitoring/dashboards">Cloud monitoring dashboards</a> to monitor performance of your apps. This dashboard has application performance metrics like requests/sec, round trip latency, HTTP error codes, and more.</p>
<pre class="devsite-terminal" suppresswarning="true" translate="no">
<code class="devsite-terminal">git clone https://github.com/google/kf</code>
<code class="devsite-terminal">cd ./kf/dashboards</code>
<code class="devsite-terminal">./create-dashboard.py my-dashboard my-cluster my-space</code>
</pre>
<h2 id="system-resources-and-performance-dashboard">System resources and performance dashboard</h2>
<p>You can view all the system resources and performance metrics such as list of nodes, pods, containers and much more using a built-in dashboard. Click the link below to access the system dashboard.</p>
  <a href="https://console.cloud.google.com/monitoring/dashboards/resourceList/kubernetes" target="_blank" class="button button-primary" track-type="tasks" track-name="consoleLink" track-metadata-position="body" track-metadata-end-goal="connectToSerialConsole" >
    System dashboard</a></p></li>
</ol>
<p>More details about this dashboard can be found <a href="https://cloud.google.com/stackdriver/docs/solutions/gke/observing">here</a>.</p>
<h2 id="create-slo-and-alerts">Create SLO and alerts</h2>
<p>You can create <a href="https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/ui/create-slo">SLOs</a> and <a href="https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/ui/create-alert">Alerts</a> on available metrics to monitor performance and availability of both system and applications. For example, you can use the metrics <code>istio.io/service/server/response_latencies</code> to setup an alert on the application roundtrip latency.</p>
<h2 id="configure-dashboard-access-control">Configure dashboard access control</h2>
<p>Follow <a href="https://cloud.google.com/monitoring/access-control">these instructions</a> to provide dashboard access to developers and other members on the team. The role <code>roles/monitoring.dashboardViewer</code> provides read-only access to dashboards.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-5a85a7965fdcfe4cf8ad48fec38d5940">5.2 - Logging and monitoring</h1>
    
	<p>Kf can use GKE&rsquo;s Google Cloud integrations
to send a log of events to your Cloud Monitoring and Cloud Logging project for observability. For more information, see
<a href="https://cloud.google.com/monitoring/kubernetes-engine">Overview of GKE operations</a>.</p>
<p>Kf deploys two server side components:</p>
<ol>
<li>Controller</li>
<li>Webhook</li>
</ol>
<p>To view the logs for these components, use the following Cloud Logging query:</p>
<pre tabindex="0"><code>resource.type=&#34;k8s_container&#34;
resource.labels.project_id=&lt;PROJECT ID&gt;
resource.labels.location=&lt;GCP ZONE&gt;
resource.labels.cluster_name=&lt;CLUSTER NAME&gt;
resource.labels.namespace_name=&#34;kf&#34;
labels.k8s-pod/app=&lt;controller OR webhook&gt;
</code></pre>
<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Replace the values inside the &lt;&gt; with the correct values.
</aside>


</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-feab5808045e2631f70969b913fafe31">5.3 - Logging and monitoring overview</h1>
    
	<p>By default, Kf includes native integration with <a href="https://cloud.google.com/monitoring">Cloud Monitoring</a> and <a href="https://cloud.google.com/logging/docs">Cloud Logging</a>. When you create a cluster, both Monitoring and Cloud Logging are enabled by default. This integration lets you monitor your running clusters and help analyze your system and application performance using advanced profiling and tracing
capabilities.</p>
<p>Application level performance metrics is provided by <a href="https://cloud.google.com/service-mesh/docs/proxy-injection">Istio sidecar injection</a> which is injected alongside applications deployed via Kf. You can also create <a href="https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/ui/create-slo">SLO</a> and <a href="https://cloud.google.com/stackdriver/docs/solutions/slo-monitoring/ui/create-alert">Alerts</a> using this default integration to monitor performance and availability of both system and applications.</p>
<p>Ensure the following are setup on your cluster:</p>
<ul>
<li>
<p><a href="https://cloud.google.com/monitoring">Cloud Monitoring</a> and <a href="https://cloud.google.com/logging/docs">Cloud Logging</a> are enabled on the Kf cluster by default unless you disabled them explicitly, so no extra step is required.</p>
</li>
<li>
<p><a href="https://cloud.google.com/service-mesh/docs/proxy-injection">Istio sidecar injection</a> is enabled.  Sidecar proxy will inject application level <a href="https://cloud.google.com/monitoring/api/metrics_istio">performance metrics</a>.</p>
</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-ca8fa32dfcb17c91cbd11356f47a4f4f">5.4 - View logs</h1>
    
	<p>Kf provides you with several types of logs. This document describes these logs and how to access them.</p>
<h2 id="application-logs">Application logs</h2>
<p>All logs written to standard output <code>stdout</code> and standard error <code>stderr</code>, are uploaded to <a href="https://cloud.google.com/logging">Cloud Logging</a> and stored under the log name <code>user-container</code>.</p>
<p>Open <a href="https://cloud.google.com/logging/docs/view/logs-explorer-interface">Cloud Logging</a> and run the following query:</p>
<pre class="devsite-click-to-copy" translate="no">
resource.type="k8s_container"
log_name="projects/<var>YOUR_PROJECT_ID</var>/logs/user-container"
resource.labels.project_id=<var>YOUR_PROJECT_ID</var>
resource.labels.location=<var>GCP_COMPUTE_ZONE (e.g. us-central1-a)</var>
resource.labels.cluster_name=<var>YOUR_CLUSTER_NAME</var>
resource.labels.namespace_name=<var>YOUR_KF_SPACE_NAME</var>
resource.labels.pod_name:<var>YOUR_KF_APP_NAME</var></pre>
<p>You should see all your application logs written on standard <code>stdout</code> and standard error <code>stderr</code>.</p>
<h2 id="access-logs-for-your-applications">Access logs for your applications</h2>
<p>Kf provides access logs using <a href="https://cloud.google.com/service-mesh/docs/proxy-injection">Istio sidecar injection</a>. Access logs are stored under the log name <code>server-accesslog-stackdriver</code>.</p>
<p>Open <a href="https://cloud.google.com/logging/docs/view/logs-explorer-interface">Cloud Logging</a> and run the following query:</p>
<pre class="devsite-click-to-copy" translate="no">
resource.type="k8s_container"
log_name="projects/<var>YOUR_PROJECT_ID</var>/logs/server-accesslog-stackdriver"
resource.labels.project_id=<var>YOUR_PROJECT_ID</var>
resource.labels.location=<var>GCP_COMPUTE_ZONE (e.g. us-central1-a)</var>
resource.labels.cluster_name=<var>YOUR_CLUSTER_NAME</var>
resource.labels.namespace_name=<var>YOUR_KF_SPACE_NAME</var>
resource.labels.pod_name:<var>YOUR_KF_APP_NAME</var></pre>
<p>You should see access logs for your application. Sample access log:</p>
<pre class="devsite-click-to-copy" translate="no">
{
  "insertId": "166tsrsg273q5mf",
  "httpRequest": {
    "requestMethod": "GET",
    "requestUrl": "http://test-app-38n6dgwh9kx7h-c72edc13nkcm.***. ***.nip.io/",
    "requestSize": "738",
    "status": 200,
    "responseSize": "3353",
    "remoteIp": "10.128.0.54:0",
    "serverIp": "10.48.0.18:8080",
    "latency": "0.000723777s",
    "protocol": "http"
  },
  "resource": {
    "type": "k8s_container",
    "labels": {
      "container_name": "user-container",
      "project_id": ***,
      "namespace_name": ***,
      "pod_name": "test-app-85888b9796-bqg7b",
      "location": "us-central1-a",
      "cluster_name": ***
    }
  },
  "timestamp": "2020-11-19T20:09:21.721815Z",
  "severity": "INFO",
  "labels": {
    "source_canonical_service": "istio-ingressgateway",
    "source_principal": "spiffe://***.svc.id.goog/ns/istio-system/sa/istio-ingressgateway-service-account",
    "request_id": "0e3bac08-ab68-408f-9b14-0aec671845bf",
    "source_app": "istio-ingressgateway",
    "response_flag": "-",
    "route_name": "default",
    "upstream_cluster": "inbound|80|http-user-port|test-app.***.svc.cluster.local",
    "destination_name": "test-app-85888b9796-bqg7b",
    "destination_canonical_revision": "latest",
    "destination_principal": "spiffe://***.svc.id.goog/ns/***/sa/sa-test-app",
    "connection_id": "82261",
    "destination_workload": "test-app",
    "destination_namespace": ***,
    "destination_canonical_service": "test-app",
    "upstream_host": "127.0.0.1:8080",
    "log_sampled": "false",
    "mesh_uid": "proj-228179605852",
    "source_namespace": "istio-system",
    "requested_server_name": "outbound_.80_._.test-app.***.svc.cluster.local",
    "source_canonical_revision": "asm-173-6",
    "x-envoy-original-dst-host": "",
    "destination_service_host": "test-app.***.svc.cluster.local",
    "source_name": "istio-ingressgateway-5469f77856-4n2pw",
    "source_workload": "istio-ingressgateway",
    "x-envoy-original-path": "",
    "service_authentication_policy": "MUTUAL_TLS",
    "protocol": "http"
  },
  "logName": "projects/*/logs/server-accesslog-stackdriver",
  "receiveTimestamp": "2020-11-19T20:09:24.627065813Z"
}
</pre>
<h2 id="audit-logs">Audit logs</h2>
<p><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/audit-logging">Audit Logs</a> provides a
chronological record of calls that have been made to the Kubernetes API Server. Kubernetes audit log entries are useful for investigating suspicious API requests, for collecting statistics, or for creating monitoring alerts for unwanted API calls.</p>
<p>Open <a href="https://cloud.google.com/logging/docs/view/logs-explorer-interface">Cloud Logging</a> and run the following query:</p>
<pre class="devsite-click-to-copy" translate="no">
resource.type="k8s_container"
log_name="projects/<var>YOUR_PROJECT_ID</var>/logs/cloudaudit.googleapis.com%2Factivity"
resource.labels.project_id=<var>YOUR_PROJECT_ID</var>
resource.labels.location=<var>GCP_COMPUTE_ZONE (e.g. us-central1-a)</var>
resource.labels.cluster_name=<var>YOUR_CLUSTER_NAME</var>
protoPayload.request.metadata.name=<var>YOUR_APP_NAME</var>
protoPayload.methodName:"deployments."</pre>
<p>You should see a trace of calls being made to the Kubernetes API server.</p>
<h2 id="configure-logging-access-control">Configure logging access control</h2>
<p>Follow <a href="https://cloud.google.com/logging/docs/access-control">these instructions</a> to provide logs access to developers and other members on the team. The role <code>roles/logging.viewer</code> provides read-only access to logs.</p>
<h2 id="use-logs-router">Use Logs Router</h2>
<p>You can also use <a href="https://cloud.google.com/logging/docs/routing/overview">Logs Router</a> to route the logs to supported destinations.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b2adb428c5ca36c2ceb9e1e03ad76231">6 - Networking</h1>
    <div class="lead">Learn about common cluster networking setups.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-7a417b00bb28a3931ab1fd45e7c32f1a">6.1 - Set up a custom domain</h1>
    <div class="lead">Learn to set up a DNS domain apps can use on your cluster.</div>
	<p>All Kf Apps that serve HTTP traffic to users or applications
outside of the cluster must be associated with a domain name.</p>
<p>Kf has three locations where domains can be configured.
Ordered by precedence, they are:</p>
<ol>
<li>Apps</li>
<li>Spaces</li>
<li>The <code>config-defaults</code> ConfigMap in the <code>kf</code> Namespace</li>
</ol>
<h2 id="edit-the-config-defaults-configmap">Edit the <code>config-defaults</code> ConfigMap</h2>
<p>The <code>config-defaults</code> ConfigMap holds cluster-wide settings for Kf and can be edited by cluster administrators.
The values in the ConfigMap are read by the Spaces controller and modify their configuration.
Domain values are reflected in the Space&rsquo;s <code>status.networkConfig.domains</code> field.</p>
<p>To modify Kf cluster&rsquo;s domain, edit the <code>config-defaults</code> ConfigMap in the <code>kf</code> Namespace:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl edit configmap config-defaults -n kf
</span></span></code></pre></div><p>Add or update the entry for the <code>spaceClusterDomain</code> key like the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spaceClusterDomain</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">my-domain.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div><p>To validate the configuration was updated correctly, check the domain value in a Space:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf space SPACE_NAME -o <span style="color:#4e9a06">&#34;jsonpath={.status.networkConfig.domains[][&#39;domain&#39;]}&#34;</span>
</span></span></code></pre></div><p>The output will look similar to:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">Getting Space some-space
some-space.my-domain.com
</code></pre><p>Each Space prefixes the cluster domains with its own name.
This prevents conflicts between Apps.</p>

<aside class="alert alert-danger" style="border-width: 1px 1px 1px 4px;">
<i class="fa-solid fa-triangle-exclamation"></i> <strong>Warning:</strong> Updating the <code>spaceClusterDomain</code> in <code>config-defaults</code> will immediately be
reflected on all Spaces and Apps that haven&rsquo;t overridden the domain.
</aside>


<h2 id="assign-space-domains">Assign Space domains</h2>
<p>Spaces are the authoritative location for domain configuration.
You can assign domains and sub-domains to each Space for developers to use.
The field for configuring domains is <code>spec.networkConfig.domains</code>.</p>
<p>Use <code>kf space</code> to view the domains assigned to a Space:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf space SPACE_NAME
</span></span></code></pre></div><p>In the output, the <code>Spec</code> field contains specific configuration for the Space
and the <code>Status</code> field reflects configuration for the Space with cluster-wide
defaults appended to the end:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">...
Spec:
  Network Config:
    Domains:
      Domain: my-space.mycompany.com
...
Status:
  Network Config:
    Domains:
      Domain: my-space.mycompany.com
      Domain: my-space.prod.us-east1.kf.mycompany.com
</code></pre>
<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Apps will use the <strong>first</strong> domain the status if developers don&rsquo;t specify a domain.
</aside>

<h3 id="add-or-remove-domains-using-the-cli">Add or remove domains using the CLI</h3>
<p>The <code>kf</code> CLI supports mutations on Space domains. Each command outputs
a diff between the old and new configurations.</p>
<p>Add a new domain with <code>kf configure-space append-domain</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf configure-space append-domain SPACE_NAME myspace.mycompany.com
</span></span></code></pre></div><p>Add or make an existing domain the default with <code>kf configure-space set-default-domain</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf configure-space set-default-domain SPACE_NAME myspace.mycompany.com
</span></span></code></pre></div><p>And finally, remove a domain:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf configure-space remove-domain SPACE_NAME myspace.mycompany.com
</span></span></code></pre></div>
<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> You can override a cluster domains by inserting a new domain on the <code>spec</code> with the same <code>domain</code>.
This ensures the space won&rsquo;t be updated if the cluster domain changes.
</aside>

<h2 id="use-apps-to-specify-domains">Use Apps to specify domains</h2>
<p>Apps can specify domains as part of their configuration.
Routes are mapped to Apps during <code>kf push</code> using the following logic:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">let current_routes  = The set of routes already on the app
let manifest_routes = The set of routes defined by the manifest
let flag_routes     = The set of routes supplied by the --route flag(s)
let no_route        = Whether the manifest has no-route:true or --no-route is set
let random_route    = Whether the manifest has random-route:true or --random-route is set

let new_routes = Union(current_routes, manifest_routes, flag_routes)

if new_routes.IsEmpty() then
  if random_route then
    new_routes.Add(CreateRandomRoute())
  else
    new_routes.Add(CreateDefaultRoute())
  end
end

if no_route then
  new_routes.RemoveAll()
end

return new_routes
</code></pre><p>If an App doesn&rsquo;t specify a Route, or requests a random Route, the first domain
on the Space is used. If the first domain on a Space changes, all Apps in the
Space using the default domain are updated to reflect it.</p>
<h2 id="customize-domain-templates">Customize domain templates</h2>
<p>Kf supports variable substitution in domains. Substitution allows a single
cluster-wide domain to be customized per-Space and to react to changes to the
ingress IP. Substitution is performed on variables with the syntax <code>$(VARIABLE_NAME)</code>
that occur in a domain.</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CLUSTER_INGRESS_IP</code></td>
<td>The IPV4 address of the cluster ingress.</td>
</tr>
<tr>
<td><code>SPACE_NAME</code></td>
<td>The name of the Space.</td>
</tr>
</tbody>
</table>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Use the <code>SPACE_NAME</code> variable in domains to allow developers in different
Spaces to avoid DNS conflicts if they push Apps with the same name.
</aside>

<h3 id="examples">Examples</h3>
<p>The following examples demonstrate how domain variables can be used to support
a variety of different organizational structures and cluster patterns.</p>
<ul>
<li>
<p>Using a wildcard DNS service like <a href="https://nip.io/">nip.io</a>:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">$(SPACE_NAME).$(CLUSTER_INGRESS_IP).nip.io
</code></pre></li>
<li>
<p>Domain for an organization with centrally managed DNS:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">$(SPACE_NAME).cluster-name.example.com
</code></pre></li>
<li>
<p>Domain for teams who manage their own DNS:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">cluster-name.$(SPACE_NAME).example.com
</code></pre></li>
<li>
<p>Domain for a cluster with warm failover and external circuit breaker:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">$(SPACE_NAME)-failover.cluster-name.example.com
</code></pre></li>
</ul>
<h2 id="differences-between-kf-and-cf">Differences between Kf and CF</h2>
<ul>
<li>Kf Spaces prefix the cluster-wide domain with the Space name.</li>
<li>Kf does not check for domain conflicts on user-specified routes.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-02e4f4812df4620e950d845e9b74bf7c">6.2 - Set up HTTPS ingress</h1>
    <div class="lead">Learn to set up a TLS certificate to enable HTTPS.</div>
	<p>You can secure the ingress gateway with HTTPS by using simple TLS, and enable HTTPS connections to specific webpages. In addition, you can redirect HTTP connections to HTTPS.</p>
<p>HTTPS creates a secure channel over an insecure network, protecting against man-in-the-middle attacks and encrypting traffic between the client and server. To prepare a web server to accept HTTPS connections, an administrator must create a public key certificate for the server. This certificate must be signed by a trusted certificate authority for a web browser to accept it without warning.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> These instructions supplement the Istio instructions to <a href="https://istio.io/latest/docs/tasks/traffic-management/ingress/secure-ingress">configure a TLS ingress gateway</a>, and assume that a valid certificate and private key for the server have already been created.
</aside>

<p>Edit the gateway named external-gateway in the <code>kf</code> namespace using the built-in Kubernetes editor:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl edit gateway -n kf external-gateway
</span></span></code></pre></div><ol>
<li>Assuming you have a certificate and key for your service, create a Kubernetes secret for the ingress gateway. Make sure the secret name does not begin with <code>istio</code> or <code>prometheus</code>. For this example, the secret is named <code>myapp-https-credential</code>.</li>
<li>Under <code>servers:</code></li>
<li>Add a section for port 443.</li>
<li>Under <code>tls:</code>, set the <code>credentialName</code> to the name of the secret you just created.</li>
<li>Under <code>hosts:</code>, add the host name of the service you want to secure with HTTPS. This can be set to an entire domain using a wildcard (e.g. <code>*.example.com</code>) or scoped to just one hostname (e.g. <code>myapp.example.com</code>).</li>
<li>There should already be a section under <code>servers:</code> for port 80 HTTP. Keep this section in the Gateway definition if you would like all traffic to come in as HTTP.</li>
<li>To redirect HTTP to HTTPS, add the value <code>httpsRedirect: true</code> under <code>tls</code> in the HTTP server section. See the <a href="https://istio.io/latest/docs/reference/config/networking/gateway/">Istio Gateway documentation</a> for reference. Note that adding this in the section where <code>hosts</code> is set to <code>*</code> means that <strong>all</strong> traffic is redirected to HTTPS. If you only want to redirect HTTP to HTTPS for a single app/domain, add a separate HTTP section specifying the redirect.</li>
</ol>
<p>Shown below is an example of a Gateway <code>spec</code> that sets up HTTPS for <code>myapp.example.com</code> and redirects HTTP to HTTPS for that host:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">spec</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">selector</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">istio</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">ingressgateway</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span><span style="color:#204a87;font-weight:bold">servers</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">myapp.example.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">https</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">number</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">443</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">protocol</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">HTTPS</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">credentialName</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">myapp-https-credential</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">mode</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">SIMPLE</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#000">myapp.example.com</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">http-my-app</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">number</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">80</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">protocol</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">HTTP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">tls</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">httpsRedirect</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#204a87;font-weight:bold">true</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">  </span>- <span style="color:#204a87;font-weight:bold">hosts</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span>- <span style="color:#4e9a06">&#39;*&#39;</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">    </span><span style="color:#204a87;font-weight:bold">port</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">name</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">http</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">number</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#0000cf;font-weight:bold">80</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span><span style="display:flex;"><span><span style="color:#f8f8f8;text-decoration:underline">      </span><span style="color:#204a87;font-weight:bold">protocol</span><span style="color:#000;font-weight:bold">:</span><span style="color:#f8f8f8;text-decoration:underline"> </span><span style="color:#000">HTTP</span><span style="color:#f8f8f8;text-decoration:underline">
</span></span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-73a1d3010499b813fad95f898bb1d8a8">6.3 - Set up network policies</h1>
    <div class="lead">Learn to set up a Kubernetes NetworkPolicies to configure traffic.</div>
	<p>Kf integrates tightly with Kubernetes and Istio to
provide robust network policy enforcement.</p>
<p>By default, Kf workloads are run in the Kubernetes cluster and resolve addresses
using <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">Kubernetes DNS</a>.
This DNS resolver will first attempt to resolve addresses within the cluster,
and only if none are found will attempt external resolution.</p>
<p>Each Kf App gets run with an Envoy sidecar injected by <a href="https://istio.io/">Istio</a>
or the <a href="https://cloud.google.com/anthos/service-mesh">Anthos Service Mesh</a> (ASM).
This sidecar proxies all network traffic in and out of the Kubernetes Pod.</p>
<p>Each Kubernetes Pod is executed on a Node, a physical or virtual machine
responsible for managing the container images that make up a Pod. Nodes exist on
a physical or virtual network.</p>
<p>Together, these form a hierarchy of systems you can apply network policies.
These are listed below from least to most granular.</p>
<h2 id="network-level-policies">Network level policies</h2>
<p>Workload protection starts with the network your GKE cluster is installed on.</p>
<p>If you&rsquo;re running Kf on a GKE cluster on GCP, Kf recommends:</p>
<ul>
<li>Placing your GKE cluster on a <a href="https://cloud.google.com/vpc/docs">Virtual Private Cloud</a> (VPC) network.
<ul>
<li>With <a href="https://cloud.google.com/vpc/docs/configure-private-google-access">Private Google Access</a> enabled.</li>
</ul>
</li>
<li>Using <a href="https://cloud.google.com/nat">Cloud NAT</a> to control egress.</li>
</ul>
<h2 id="node-level-policies">Node level policies</h2>
<p>You can set up policies for containers running on the Node using Kubernetes NetworkPolicies.
These are the closest mapping to Cloud Foundry network policies that exist in Kubernetes.</p>
<p>NetworkPolicies are backed by a Kubernetes add-on. If you set up your own GKE
cluster, you will need to <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy">enable NetworkPolicy enforcement</a>.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> NetworkPolicies applied by <a href="https://www.projectcalico.org/">Project Calico</a>
filter on a per-connection basis. On Linux they are backed by <a href="https://en.wikipedia.org/wiki/Iptables">iptables</a>.
Like any firewall, <strong>they are not a substitute of authentication and authorization</strong>.
</aside>

<p>Kf labels Apps with <code>kf.dev/networkpolicy=app</code> and builds with <code>kf.dev/networkpolicy=build</code>.
This allows you to target NetworkPolicies directly at Pods running Apps or Builds.</p>
<p>Each Kf Space creates two NetworkPolicies to start with, one targeting Apps and
one targeting Builds. You can change the configuration on the Space&rsquo;s
<code>spec.networkConfig.(app|build)NetworkPolicy.(in|e)gress</code> fields.
These fields can be set to one of the following values:</p>
<table>
<thead>
<tr>
<th>Enum Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>PermitAll</code></td>
<td>Allows all traffic.</td>
</tr>
<tr>
<td><code>DenyAll</code></td>
<td>Denies all traffic.</td>
</tr>
</tbody>
</table>
<p>By default Kf uses a permissive network policy. This allows the following
functionality that Kf uses:</p>
<ul>
<li>North/South routing to the cluster ingress gateway</li>
<li>Egress to the Internet e.g. to fetch Buildpacks</li>
<li>East/West routing between Apps</li>
<li>Access to the Kubernetes DNS server</li>
<li>Access to container registries</li>
<li>Direct access to the VPC network</li>
<li>Access to Google services like Cloud Logging</li>
<li>Access to the Workload Identity server for automatic rotating credentials</li>
</ul>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Setting a default <code>DenyAll</code> policy will break existing and new Apps and Builds
unless you create additional NetworkPolicies to add back the connections listed
above.
</aside>

<h2 id="service-mesh-policies">Service mesh policies</h2>
<p>If you need fine-grained networking control, authentication, authorization, and
observability you can apply policies using <a href="https://cloud.google.com/service-mesh/docs/overview">Anthos Service Mesh</a>.</p>
<p>A service mesh is an infrastructure layer that enables managed, observable and
secure communication across your services, letting you create robust enterprise
applications made up of many microservices on your chosen infrastructure.</p>
<p>You can see the <a href="https://cloud.google.com/service-mesh/docs/supported-features">list of supported features here</a>.</p>

</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-cbe31da3743a949ac1b65626af3b367b">7 - Security</h1>
    <div class="lead">Learn about security considerations for your Kf cluster.</div>
	
</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-618739ac86f5ed17603f48ea81584abf">7.1 - Security Overview</h1>
    <div class="lead">Unerstand Kf&rsquo;s security posture.</div>
	<p>Kf aims to provide a similar developer experience to Cloud Foundry, replicating the build, push, and deploy lifecycle. It does this by building a developer UX layer on top of widely-known, broadly used and adopted technologies like Kubernetes, Istio, and container registries rather than by implementing all the pieces from the ground up.</p>

<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Kf should be used in a GCP Project dedicated to your evaluation. See <a href="#important-considerations">Important considerations</a> for more information.
</aside>

<p>When making security decisions, Kf aims to provide complete solutions that are native to their respective components and can be augmented with other mechanisms. Breaking that down:</p>
<ul>
<li><strong>Complete solutions</strong> means that Kf tries not to provide partial solutions that can lead to a false sense of security.</li>
<li><strong>Native</strong> means that the solutions should be a part of the component rather than a Kf construct to prevent breaking changes.</li>
<li><strong>Can be augmented</strong> means the approach Kf takes should work seamlessly with other Kubernetes and Google Cloud tooling for defense in depth.</li>
</ul>
<h2 id="important-considerations">Important considerations</h2>
<p>In addition to the <a href="#current-limitations">Current limitations</a> described below, it is important that you read through and understand the items outlined in this section.</p>
<h3 id="workload-identity">Workload Identity</h3>
<p>By default, Kf uses <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity">Workload Identity</a> to provide secure delivery and rotation of the Service Account credentials used by Kf to interact with your Google Cloud Project. Workload Identity achieves this by mapping a Kubernetes Service Account (KSA) to a Google Service Account (GSA). The Kf controller runs in the <code>kf</code> namespace and uses a KSA named <code>controller</code> mapped to your GSA to do the following things:</p>
<ol>
<li>Write metrics to Stackdriver</li>
<li>When a new Kf space is created (<code>kf create-space</code>), the Kf controller creates a new KSA named <code>kf-builder</code> in the new space and maps it to the same GSA.</li>
<li>The <code>kf-builder</code> KSA is used by Tekton to push and pull container images to Google Container Registry (gcr.io)</li>
</ol>
<p>This diagram illustrates those interactions:</p>

<figure>
    <img src="./wi_overview.svg"
         alt="Workload identity overview diagram"/> 
</figure>

<h3 id="current-limitations">Current limitations</h3>
<ul>
<li>
<p>Kf doesn&rsquo;t provide pre-built RBAC roles. Until
Kf provides this, use
<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control">RBAC</a>.</p>
</li>
<li>
<p>A developer pushing an app with Kf can also create
Pods (with <code>kubectl</code>) that can use the <code>kf-builder</code> KSA with the permissions
of its associated GSA.</p>
</li>
<li>
<p>Deploying to Kf requires write access to a container
registry. Deploy Kf in a dedicated project without
access to production resources. Grant developers access to push code to the
Artifact Repository by
<a href="https://cloud.google.com/container-registry/docs/access-control">granting them <code>roles/storage.admin</code></a>
on the project or buckets that Artifact Repository uses.</p>
</li>
<li>
<p>Kf uses the same Pod to fetch, build, and store images.
Assume that any credentials that you provide can be known by the authors and
publishers of the buildpacks you use.</p>
</li>
<li>
<p>Kf doesn&rsquo;t support quotas to protect against noisy
neighbors. Use Kubernetes
<a href="https://kubernetes.io/docs/concepts/policy/resource-quotas/">resource quotas</a>.</p>
</li>
</ul>
<h2 id="other-resources">Other resources</h2>
<h3 id="google-cloud">Google Cloud</h3>
<h4 id="general">General</h4>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/security-overview">GKE security overview</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/concepts/multitenancy-overview">GKE cluster multi-tenancy</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/workload-identity">Workload Identity</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/iam">GKE and Cloud IAM policies</a></li>
</ul>
<h4 id="recommended-protections">Recommended protections</h4>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/protecting-cluster-metadata">Protecting cluster metadata</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control">Role-based access control</a></li>
</ul>
<h4 id="advanced-protections">Advanced protections</h4>
<ul>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/sandbox-pods">GKE Sandbox</a></li>
<li><a href="https://cloud.google.com/kubernetes-engine/docs/how-to/network-policy">Network policies</a></li>
</ul>

</div>



    
      
  
  
  
  

  
  

  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-304425574fd6e3f21a7dd1619983268f">7.2 - Role-based access control</h1>
    <div class="lead">Learn about how to share a Kf cluster using roles.</div>
	<p>Kf provides a set of Kubernetes roles that allow multiple teams to share a Kf cluster.
This page describes the roles and best practices to follow when using them.</p>
<h2 id="when-to-use-kf-roles">When to use Kf roles</h2>
<p>Kf roles allow multiple teams to share a Kubernetes
cluster with Kf installed. The roles provide access to
individual Kf Spaces.</p>
<p>Use Kf roles to share access to a cluster if the
following are true:</p>
<ul>
<li>The cluster is used by trusted teams.</li>
<li>Workloads on the cluster share the same assumptions about the level of
security provided by the environment.</li>
<li>The cluster exists in a Google Cloud project that is tightly controlled.</li>
</ul>
<p>Kf roles will not:</p>
<ul>
<li>Protect your cluster from untrusted developers or workloads. See the
<a href="https://cloud.google.com/blog/products/containers-kubernetes/exploring-container-security-the-shared-responsibility-model-in-gke-container-security-shared-responsibility-model-gke">GKE shared responsibility model</a>
for more information.</li>
<li>Provide isolation for your workloads. See the
<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster">guide to harden your cluster</a>
for more information.</li>
<li>Prevent
<a href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control">additional Kubernetes roles</a>
from being defined that interact with Kf.</li>
<li>Prevent access from <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/iam">administrators who have access to the Google Cloud project or cluster</a>.</li>
</ul>
<h2 id="roles">Kf roles</h2>
<p>The following sections describe the Kubernetes RBAC Roles provided by
Kf and how they interact with GKE IAM.</p>
<h3 id="predefined_roles">Predefined roles</h3>
<p>Kf provides several predefined Kubernetes roles to help
you provide access to different subjects that perform different roles. Each
predefined role can be bound to a subject within a Kubernetes Namespace managed
by a Kf Space.</p>
<p>When a subject is bound to a role within a Kubernetes Namespace, their access is
limited to objects that exist in the Namespace that match the grants listed in
the role. In Kf, some resources are defined at the cluster
scope. Kf watches for changes to subjects in the Namespace
and grants additional, limited, roles at the cluster scope.</p>
<table>
<thead>
<tr>
<th>Role</th>
<th>Title</th>
<th>Description</th>
<th>Scope</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>space-auditor</code></td>
<td>Space Auditor</td>
<td>Allows read-only access to a Space.</td>
<td>Space</td>
</tr>
<tr>
<td><code>space-developer</code></td>
<td>Space Developer</td>
<td>Allows application developers to deploy and manage applications within a Space.</td>
<td>Space</td>
</tr>
<tr>
<td><code>space-manager</code></td>
<td>Space Manager</td>
<td>Allows administration and the ability to manage auditors, developers, and managers in a Space.</td>
<td>Space</td>
</tr>
<tr>
<td><code>SPACE_NAME-manager</code></td>
<td>Dynamic Space Manager</td>
<td>Provides write access to a single Space object, automatically granted to all subjects with the <code>space-manager</code> role within the named Space.</td>
<td>Cluster</td>
</tr>
<tr>
<td><code>kf-cluster-reader</code></td>
<td>Cluster Reader</td>
<td>Allows read-only access to cluster-scoped Kf objects, automatically granted to all <code>space-auditor</code>, <code>space-developer</code>, and <code>space-manager</code>.</td>
<td>Cluster</td>
</tr>
</tbody>
</table>
<p>Information about the policy rules that make up each predefined role can be found in the
<a href="/docs/v2.11/operator/security/kubernetes-roles/">Kf roles reference documentation</a>.</p>
<h3 id="interaction_with_iam">Google Cloud IAM roles</h3>
<p>Kf roles provide access control for objects within a
Kubernetes cluster. Subjects must also be granted an Cloud IAM role to
authenticate to the cluster:</p>
<ul>
<li>
<p><strong>Platform administrators</strong> should be granted the <code>roles/container.admin</code> Cloud IAM role.
This will allow them to install, upgrade, and delete Kf as well as create, and delete
cluster scoped Kf objects like <a href="kf-dependencies#custom-resources">Spaces or ClusterServiceBrokers</a>.</p>
</li>
<li>
<p><strong>Kf end-users</strong> should be granted the <code>roles/container.viewer</code> Cloud IAM role.
This role will allow them to authenticate to a cluster with limited permissions that can be expanded using
Kf roles.</p>
</li>
</ul>
<p>Google Cloud IAM offers additional <a href="https://cloud.google.com/iam/docs/understanding-roles#predefined_roles">predefined Roles</a>
for GKE to solve more advanced use cases.</p>
<h2 id="map-cloud-foundry-roles-to-kf">Map Cloud Foundry roles to Kf</h2>
<p><a href="https://docs.cloudfoundry.org/concepts/roles.html">Cloud Foundry provides roles</a>
are similar to Kf&rsquo;s <a href="#predefined_roles">predefined roles</a>.
Cloud Foundry has two major types of roles:</p>
<ul>
<li>Roles assigned by the User Account and Authentication (UAA) subsystem that provide
coarse-grained OAuth scopes applicable to all Cloud Foundry API endpoints.</li>
<li>Roles granted within the Cloud Controller API (CAPI) that provide fine-grained
access to API resources.</li>
</ul>
<h3 id="uaa-roles">UAA roles</h3>
<p>Roles provided by UAA are most similar to project scoped Google Cloud IAM roles:</p>
<ul>
<li><strong>Admin</strong> users in Cloud Foundry can perform administrative activities for all
Cloud Foundry organizations and spaces. The role is most similar to the
<code>roles/container.admin</code> Google Cloud IAM role.</li>
<li><strong>Admin read-only</strong> users in Cloud Foundry can access all Cloud Foundry API
endpoints. The role is most similar to the <code>roles/container.admin</code>
Google Cloud IAM role.</li>
<li><strong>Global auditor</strong> users in Cloud Foundry have read access to all Cloud Foundry API
endpoints except for secrets.
There is no equivalent Google Cloud IAM role, but you can create a
<a href="https://cloud.google.com/iam/docs/creating-custom-roles">custom role</a> with similar permissions.</li>
</ul>
<h3 id="cloud-controller-api-roles">Cloud Controller API roles</h3>
<p>Roles provided by CAPI are most similar to Kf roles granted within a cluster
to subjects that have the <code>roles/container.viewer</code> Google Cloud IAM role on the owning project:</p>
<ul>
<li><strong>Space auditors</strong> in Cloud Foundry have read-access to resources in a CF space.
The role is most similar to the <code>space-auditor</code> Kf role.</li>
<li><strong>Space developers</strong> in Cloud Foundry have the ability to deploy and manage
applications in a CF space.
The role is most similar to the <code>space-developer</code> Kf role.</li>
<li><strong>Space managers</strong> in Cloud Foundry can modify settings for the CF space and
assign users to roles.
The role is most similar to the <code>space-manager</code> Kf role.</li>
</ul>
<h2 id="whats-next">What&rsquo;s next</h2>
<ul>
<li>Learn more about <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/security-overview">GKE security in the Security Overview</a>.</li>
<li>Make sure you understand the <a href="https://cloud.google.com/blog/products/containers-kubernetes/exploring-container-security-the-shared-responsibility-model-in-gke-container-security-shared-responsibility-model-gke">GKE shared responsibility
model</a>.</li>
<li>Learn more about <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/access-control">access control</a> in GKE.</li>
<li>Read the <a href="https://cloud.google.com/kubernetes-engine/docs/concepts/multitenancy-overview">GKE multi-tenancy overview</a>.</li>
<li>Learn about <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster">hardening your GKE cluster</a>.</li>
<li>Understand the <a href="/docs/v2.11/operator/security/kubernetes-roles/">Kubernetes permissions that make up each Kf predefined role</a>.</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-40ff7467b86eb5796edbb4944e3340fe">7.3 - Configure role-based access control</h1>
    <div class="lead">Learn to grant users different roles on a cluster.</div>
	<p>The following steps guide you through configuring role-based access control (RBAC) in a Kf Space.</p>
<h2 id="before-you-begin">Before you begin</h2>
<p>Please follow the <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control">GKE RBAC guide</a> before continuing with the following steps.</p>
<h2 id="configure-identity-and-access-management-iam">Configure Identity and Access Management (IAM)</h2>
<p>In addition to permissions granted through Kf RBAC, users, groups, or service accounts must also be authenticated to view GKE clusers at the project level. This requirement is the same as for configuring GKE RBAC, meaning users/groups must have at least the <code>container.clusters.get</code> IAM permission in the project containing the cluster. This permission is included by the <code>container.clusterViewer</code> role, and other more privilleged roles. For more information, review <a href="https://cloud.google.com/kubernetes-engine/docs/how-to/role-based-access-control#iam-interaction">Interaction with Identity and Access Management</a>.</p>
<p>Assign <code>container.clusterViewer</code> to a user or group.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>gcloud projects add-iam-policy-binding <span style="color:#4e9a06">${</span><span style="color:#000">CLUSTER_PROJECT_ID</span><span style="color:#4e9a06">}</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --role<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;container.clusterViewer&#34;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>  --member<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;</span><span style="color:#4e9a06">${</span><span style="color:#000">MEMBER</span><span style="color:#4e9a06">}</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Example member values are:</p>
<ul>
<li>user:test-user@gmail.com</li>
<li>group:admins@example.com</li>
<li>serviceAccount:test123@example.domain.com</li>
</ul>
<h2 id="manage-space-membership-as-spacemanager">Manage Space membership as SpaceManager</h2>
<p>The cluster admin role, or members with <strong>SpaceManager</strong> role, can assign role to a user, group or service account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf set-space-role MEMBER -t <span style="color:#ce5c00;font-weight:bold">[</span>Group<span style="color:#000;font-weight:bold">|</span>ServiceAccount<span style="color:#000;font-weight:bold">|</span>User<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div><p>The cluster admin role, or members with <strong>SpaceManager</strong> role, can remove a member from a role.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf unset-space-role MEMBER -t <span style="color:#ce5c00;font-weight:bold">[</span>Group<span style="color:#000;font-weight:bold">|</span>ServiceAccount<span style="color:#000;font-weight:bold">|</span>User<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div><p>You can view members and their roles within a Space.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf space-users
</span></span></code></pre></div><h3 id="examples">Examples</h3>
<p>Assign <strong>SpaceDeveloper</strong> role to a user.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf set-space-role alice@example.com SpaceDeveloper
</span></span></code></pre></div><p>Assign <strong>SpaceDeveloper</strong> role to a group.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf set-space-role devs@example.com SpaceDeveloper -t Group
</span></span></code></pre></div><p>Assign <strong>SpaceDeveloper</strong> role to a Service Account.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf set-space-role sa-dev@example.domain.com SpaceDeveloper -t ServiceAccount
</span></span></code></pre></div><h2 id="app-development-as-spacedeveloper">App development as SpaceDeveloper</h2>
<p>Members with <strong>SpaceDeveloper</strong> role can perform Kf App development operations within the Space.</p>
<p>To push an App:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf push app_name -p <span style="color:#ce5c00;font-weight:bold">[</span>PATH_TO_APP_ROOT_DIRECTORY<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div><p>To view logs of an App:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf logs app_name
</span></span></code></pre></div><p>SSH into a Kubernetes Pod running the App:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf ssh app_name
</span></span></code></pre></div><p>View available service brokers:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf marketplace
</span></span></code></pre></div><h2 id="view-apps-as-spacemanager-or-spaceauditor">View Apps as SpaceManager or SpaceAuditor</h2>
<p>Members with <strong>SpaceManager</strong> or <strong>SpaceAuditor</strong> role could view available Apps within the Space:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf apps
</span></span></code></pre></div><h2 id="view-kf-spaces-within-a-cluster">View Kf Spaces within a cluster</h2>
<p>All roles (<strong>SpaceManager</strong>, <strong>SpaceDeveloper</strong>, and <strong>SpaceAuditor</strong>) can view available Kf Spaces within a cluster:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf spaces
</span></span></code></pre></div><p>View Space members and their roles within a Space.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf space-users
</span></span></code></pre></div><h2 id="impersonation-flags">Impersonation flags</h2>
<p>To verify a member&rsquo;s permission, a member with more priviliaged permission can test another member&rsquo;s permissions using the impersonation flags: <code>--as</code> and <code>--as-group</code>.</p>
<p>For example, as a cluster admin, you can verify if a user (username: bob) has permission to push an App.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf push APP_NAME --as bob
</span></span></code></pre></div><p>Verify a group (<code>manager-group@example.com</code>) has permission to assign permission to other members.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf set-space-role bob SpaceDeveloper --as-group manager-group@example.com
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4497b76abb619113621471039e747061">7.4 - Enable compute isolation</h1>
    <div class="lead">Isolate the underlying nodes certain apps or builds are scheuled onto.</div>
	<p>Kf Apps can be deployed on dedicated nodes in the cluster.
This feature is required if you have the circumstances where you might want more
control on a node where an App Pod lands. For example:</p>
<ul>
<li>If you are sharing the same cluster for different Apps but want dedicated
nodes for a particular App.</li>
<li>If you want dedicated nodes for a given organization (Kf Space).</li>
<li>If you want to target a specific operating system like Windows.</li>
<li>If you want to co-locate Pods from two different services that frequently
communicate.</li>
</ul>
<p>To enable compute isolation, Kf uses the Kubernetes <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node">nodeSelector</a>. To
use this feature, first add labels on the nodes or node pools where you want
your App Pods to land and then add the same qualifying labels on the Kf Space.
All the Apps installed in this Space then land on the nodes with matching labels.</p>
<p>Kf creates a Kubernetes pod to execute each Kf Build, the buildNodeSelector feature can be used to isolate compute resources to execute only the Build pods. One use case is to isolate Build pods to run on nodes with SSD, while running the App pods on other nodes. The BuildNodeSelectors feature provides compute resource optimization and flexibility in the cluster. Please refer to chapter &lsquo;Configure BuildNodeSelectors and a build node pool&rsquo; on this page.</p>
<h2 id="configure-nodeselector-in-a-kf-cluster">Configure nodeSelector in a Kf cluster</h2>
<p>By default, compute isolation is disabled. Use the following procedure
to configure labels and nodeSelector.</p>
<ol>
<li>
<p>Add a label (<code>distype=ssd</code>) on the node where you want your application pods to
land.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl label nodes nodeid <span style="color:#000">disktype</span><span style="color:#ce5c00;font-weight:bold">=</span>ssd
</span></span></code></pre></div></li>
<li>
<p>Add the same label on the Kf Space. All Apps deployed in this Space
will then land on the qualifying nodes.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf configure-space set-nodeselector space-name disktype ssd
</span></span></code></pre></div><p>You can add multiple labels by running the same command again.</p>
</li>
<li>
<p>Check the label is configured.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf configure-space get-nodeselector space-name
</span></span></code></pre></div></li>
<li>
<p>Delete the label from the space.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf configure-space unset-nodeselector space-name disktype
</span></span></code></pre></div></li>
</ol>
<h2 id="override-nodeselector-for-kf-stacks">Override nodeSelector for Kf stacks</h2>
<p>Deployment of Kf Apps can be further targeted based
on what stack is being used to build and package the App. For
example, if you want your applications built with <code>spaceStacksV2</code> to land on
nodes with Linux kernel 4.4.1., <code>nodeSelector</code> values on a stack override the
values configured on the Space.</p>
<p>To configure the <code>nodeSelector</code> on a stack:</p>
<ol>
<li>
<p>Edit the <code>config-defaults</code> of your Kf cluster and add the labels.</p>
<pre tabindex="0"><code class="language-none" data-lang="none">$ kubectl -n kf edit configmaps config-defaults
</code></pre></li>
<li>
<p>Add <code>nodeSelector</code> to the stacks definition.</p>
<pre tabindex="0"><code class="language-none" data-lang="none">.....
.....
spaceStacksV2: |
- name:  cflinuxfs3
        image: cloudfoundry/cflinuxfs3
        nodeSelector:
              OS_KERNEL: LINUX_4.4.1 
.....
.....
</code></pre></li>
</ol>
<h2 id="configure-buildnodeselectors-and-a-build-node-pool">Configure BuildNodeSelectors and a Build node pool</h2>
<p>Build node selectors are only effective at overriding the node selectors for the Build pods, they do not affect App pods. For example, if you specify both the node selectors on the Space and the Build node selectors in Kfsystem, App pods will have the Space node selectors while the Build pods will have the Build node selectors from Kfsystem; if node selectors are only specified in the Space, both the App and Build pods will have the node selector from the Space.</p>
<ol>
<li>
<p>Add labels (<code>disktype:ssd</code> for example) on the nodes that you want your Build pods to be assigned to.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl label nodes nodeid <span style="color:#000">disktype</span><span style="color:#ce5c00;font-weight:bold">=</span>ssd
</span></span></code></pre></div></li>
<li>
<p>Add/update Build node selectors (in the format of <code>key:value</code> pairs) by patching KfSystem CR.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl patch kfsystem kfsystem --type<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;json&#39;</span> -p<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;[{&#39;</span>op<span style="color:#4e9a06">&#39;: &#39;</span>replace<span style="color:#4e9a06">&#39;, &#39;</span>path<span style="color:#4e9a06">&#39;: &#39;</span>/spec/kf/config/buildNodeSelectors<span style="color:#4e9a06">&#39;, &#39;</span>value<span style="color:#4e9a06">&#39;: {&lt;key&gt;:&lt;value&gt;}}]&#39;</span>
</span></span></code></pre></div><p>For example, to add <code>disktype=ssd</code> as the Build node selector:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl patch kfsystem kfsystem --type<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;json&#39;</span> -p<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;[{&#39;</span>op<span style="color:#4e9a06">&#39;: &#39;</span>replace<span style="color:#4e9a06">&#39;, &#39;</span>path<span style="color:#4e9a06">&#39;: &#39;</span>/spec/kf/config/buildNodeSelectors<span style="color:#4e9a06">&#39;, &#39;</span>value<span style="color:#4e9a06">&#39;: {&#34;disktype&#34;:&#34;ssd&#34;}}]&#39;</span>
</span></span></code></pre></div></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f4376724fa27ad233014070cf3e62b66">7.5 - Kubernetes Roles</h1>
    <div class="lead">Understand how Kf uses Kubernetes&rsquo; RBAC to assign roles.</div>
	<p>The following sections describe the <a href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/">Kubernetes ClusterRoles</a>
that are created by Kf and lists the permissions that are
contained in each ClusterRole.</p>
<h2 id="space-developer">Space developer role</h2>
<p>The Space developer role aggregates permissions application developers use
to deploy and manage applications within a Kf Space.</p>
<p>You can retrieve the permissions granted to Space developers on your cluster
using the following command.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl describe clusterrole space-developer
</span></span></code></pre></div><p>The default installation of Kf provides the following
permissions:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">PolicyRule:
  Resources                               Non-Resource URLs  Resource Names  Verbs
  ---------                               -----------------  --------------  -----
  events                                  []                 []              [*]
  secrets                                 []                 []              [*]
  *.kf.dev                                []                 []              [*]
  networkpolicies.networking.k8s.io       []                 []              [*]
  pods/exec                               []                 []              [create]
  *.upload.kf.dev                         []                 []              [create]
  pods/log                                []                 []              [get list watch]
  pods                                    []                 []              [get list watch]
  rolebindings.rbac.authorization.k8s.io  []                 []              [get list watch]
</code></pre><h2 id="space-auditor">Space auditor role</h2>
<p>The Space auditor role aggregates read-only permissions that auditors and
automated tools use to validate applications within a
Kf Space.</p>
<p>You can retrieve the permissions granted to Space auditors on your cluster
using the following command.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl describe clusterrole space-auditor
</span></span></code></pre></div><p>The default installation of Kf provides the following
permissions:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">PolicyRule:
  Resources                               Non-Resource URLs  Resource Names  Verbs
  ---------                               -----------------  --------------  -----
  events                                  []                 []              [*]
  apps.kf.dev                             []                 []              [get list watch]
  rolebindings.rbac.authorization.k8s.io  []                 []              [get list watch]
</code></pre><h2 id="space-manager">Space manager role</h2>
<p>The Space manager role aggregates permissions that allow delegation of duties to
others within a Kf Space.</p>
<p>You can retrieve the permissions granted to Space managers on your cluster
using the following command.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl describe clusterrole space-manager
</span></span></code></pre></div><p>The default installation of Kf provides the following
permissions:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">PolicyRule:
  Resources                               Non-Resource URLs  Resource Names     Verbs
  ---------                               -----------------  --------------     -----
  clusterroles.rbac.authorization.k8s.io  []                 [space-auditor]    [bind]
  clusterroles.rbac.authorization.k8s.io  []                 [space-developer]  [bind]
  clusterroles.rbac.authorization.k8s.io  []                 [space-manager]    [bind]
  rolebindings.rbac.authorization.k8s.io  []                 []                 [get list update patch watch]
  apps.kf.dev                             []                 []                 [get list watch]
</code></pre>
<aside class="alert alert-info" style="border-width: 1px 1px 1px 4px;">
<i class="fas fa-star ml-2"></i> <strong>Note:</strong> Subjects bound to the <code>space-manager</code> ClusterRole within a
Kf Space are also granted write access to that Space.
</aside>

<h2 id="dynamic-space-manager">Dynamic Space manager role</h2>
<p>Each Kf Space creates a ClusterRole with the name
<code>SPACE_NAME-manager</code>, where
<code>SPACE_NAME-manager</code> is called the dynamic manager role.</p>
<p>Kf
automatically grants all subjects with the <code>space-manager</code> role within the
Space the dynamic manager role at the cluster scope. The permissions for the
dynamic manager role allow Space managers to update settings on the Space with
the given name.</p>
<p>You can retrieve the permissions granted to the dynamic manager role for any
Space on your cluster using the following command.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl describe clusterrole SPACE_NAME-manager
</span></span></code></pre></div><p>The default installation of Kf provides the following
permissions:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">PolicyRule:
  Resources      Non-Resource URLs  Resource Names  Verbs
  ---------      -----------------  --------------  -----
  spaces.kf.dev  []                 [SPACE_NAME]    [get list watch update patch]
</code></pre><h2 id="kf-cluster-reader">Kf cluster reader role</h2>
<p>Kf automatically grants the <code>kf-cluster-reader</code> role to all users on a
cluster that already have the <code>space-developer</code>, <code>space-auditor</code>, or <code>space-manager</code>
role within a Space.</p>
<p>You can retrieve the permissions granted to Space Kf
cluster readers on your cluster using the following command.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl describe clusterrole kf-cluster-reader
</span></span></code></pre></div><p>The default installation of Kf provides the following
permissions:</p>
<pre tabindex="0"><code class="language-none" data-lang="none">PolicyRule:
  Resources                     Non-Resource URLs  Resource Names  Verbs
  ---------                     -----------------  --------------  -----
  namespaces                    []                 [kf]            [get list watch]
  clusterservicebrokers.kf.dev  []                 []              [get list watch]
  spaces.kf.dev                 []                 []              [get list watch]
</code></pre>
</div>



    
	
  

    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-340fae6dd8d6497edae52aa4e6cac4ff">8 - Stacks and Buildpacks</h1>
    
	<p>Learn about configuring stacks and buildpacks for your platform.</p>

</div>



    
      
  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-6dc2637a3c7511c15b5eea65056a667c">8.1 - Customize stacks</h1>
    
	<p>The Stack configuration can be updated by editing the <code>kfsystem</code> Custom Resource:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl edit kfsystem kfsystem
</span></span></code></pre></div><p>This example sets the Google Cloud buildpacks a V3 Stack:</p>
<pre tabindex="0"><code>spec:
  kf:
    config:
      spaceStacksV3:
      - name: google
        description: Google buildpacks (https://github.com/GoogleCloudPlatform/buildpacks)
        buildImage: gcr.io/buildpacks/builder:v1
        runImage: gcr.io/buildpacks/gcp/run:v1
</code></pre><p>This new Stack can now be pushed:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf push myapp --stack google
</span></span></code></pre></div><p>This example configures the Ruby V2 buildpack and sets the build pipeline defaults to use V2 Stacks:</p>
<pre tabindex="0"><code>spec:
  kf:
    config:
      spaceDefaultToV3Stack: false
      spaceBuildpacksV2:
      - name: ruby_buildpack
        url: https://github.com/cloudfoundry/ruby-buildpack
      spaceStacksV2:
      - name: cflinuxfs3
        image: cloudfoundry/cflinuxfs3@sha256:5219e9e30000e43e5da17906581127b38fa6417f297f522e332a801e737928f5
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-7b5d652a95409ea35a6e10e2bce40600">8.2 - Customize stacks and buildpacks</h1>
    
	<p>Buildpacks are used by Kf to turn an application&rsquo;s source
code into an executable image. Cloud Native buildpacks use the latest
<a href="https://github.com/buildpack/spec">Buildpack API v3</a>.
Companies are actively adding v3 support to existing buildpacks.</p>
<p>Kf supports buildpacks that conform to both <a href="https://docs.cloudfoundry.org/buildpacks/understand-buildpacks.html">V2</a>
and <a href="https://docs.cloudfoundry.org/buildpacks/understand-buildpacks.html">V3</a>
of the Buildpack API specification.</p>
<h2 id="compare-v2-and-v3-buildpacks">Compare V2 and V3 buildpacks</h2>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">V2 buildpacks</th>
<th style="text-align:left">V3 buildpacks</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Alternate names</td>
<td style="text-align:left">Cloud Foundry buildpacks</td>
<td style="text-align:left">Cloud Native buildpacks (CNB), Builder Images</td>
</tr>
<tr>
<td style="text-align:left">Status</td>
<td style="text-align:left">Being replaced</td>
<td style="text-align:left">Current</td>
</tr>
<tr>
<td style="text-align:left">Ownership</td>
<td style="text-align:left">Cloud Foundry</td>
<td style="text-align:left"><a href="https://buildpacks.io">Buildpacks.io</a></td>
</tr>
<tr>
<td style="text-align:left">Stack</td>
<td style="text-align:left">Shared by builder and runtime</td>
<td style="text-align:left">Optionally different for builder and runtime</td>
</tr>
<tr>
<td style="text-align:left">Local development</td>
<td style="text-align:left">Not possible</td>
<td style="text-align:left">Yes, with the <a href="https://buildpacks.io"><code>pack</code> CLI</a></td>
</tr>
<tr>
<td style="text-align:left">Custom buildpacks</td>
<td style="text-align:left">Available at runtime</td>
<td style="text-align:left">Must be built into the builder</td>
</tr>
</tbody>
</table>
<h2 id="buildpack-lifecycle">Buildpack lifecycle</h2>
<table>
<thead>
<tr>
<th>Step</th>
<th>Cloud Foundry</th>
<th>Kf with buildpacks V2</th>
<th>Kf with buildpacks V3</th>
</tr>
</thead>
<tbody>
<tr>
<td>Source location</td>
<td>BITS service</td>
<td>Container registry</td>
<td>Container registry</td>
</tr>
<tr>
<td>Buildpack location</td>
<td>BOSH/HTTP</td>
<td>HTTP</td>
<td>Container registry</td>
</tr>
<tr>
<td>Stack location</td>
<td>BOSH</td>
<td>Container registry</td>
<td>Container registry</td>
</tr>
<tr>
<td>Result</td>
<td>Droplet (App binary without stack)</td>
<td>Image (Droplet on a stack)</td>
<td>Image</td>
</tr>
<tr>
<td>Runtime</td>
<td>Droplet glued on top of stack and run</td>
<td>Run produced image</td>
<td>Run produced image</td>
</tr>
</tbody>
</table>
<p>Kf <em>always</em> produces a full, executable image as a result of its build process.
Cloud Foundry, on the other hand, produces parts of an executable image at build time and the rest is added at runtime.</p>
<p>Kf chose to follow the model of always producing a full image for the following reasons:</p>
<ul>
<li>Images can be exported, run locally, and inspected statically</li>
<li>Better security and auditing with tools like <a href="https://cloud.google.com/binary-authorization/">binary authorization</a></li>
<li>App deployments are reproducible</li>
</ul>
<h2 id="kf-and-buildpacks">Kf and buildpacks</h2>
<p>Kf stores its global list of buildpacks and stacks in the
<code>config-defaults</code> ConfigMap in the <code>kf</code> Namespace. Modification of the buildpacks and stacks properties should be done at the <code>kfsystem</code> Custom Resource, the Kf operator automatically updates the <code>config-defaults</code> ConfigMap based on the values set at <code>kfsystem</code>.</p>
<p>Each Space reflects these buildpacks in its status field.
For a Space named <code>buildpack-docs</code> you could run the following to see the full
Space configuration:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf space buildpack-docs
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Getting Space buildpack-docs
</span></span><span style="display:flex;"><span>API Version:  kf.dev/v1alpha1
</span></span><span style="display:flex;"><span>Kind:         Space
</span></span><span style="display:flex;"><span>Metadata:
</span></span><span style="display:flex;"><span>  Creation Timestamp:  2020-02-14T15:09:52Z
</span></span><span style="display:flex;"><span>  Name:                buildpack-docs
</span></span><span style="display:flex;"><span>  Self Link:           /apis/kf.dev/v1alpha1/spaces/buildpack-docs
</span></span><span style="display:flex;"><span>  UID:                 0cf1e196-4f3c-11ea-91a4-42010a80008d
</span></span><span style="display:flex;"><span>Status:
</span></span><span style="display:flex;"><span>  Build Config:
</span></span><span style="display:flex;"><span>    Buildpacks V2:
</span></span><span style="display:flex;"><span>    - Name:      staticfile_buildpack
</span></span><span style="display:flex;"><span>      URL:       https://github.com/cloudfoundry/staticfile-buildpack
</span></span><span style="display:flex;"><span>      Disabled:  <span style="color:#204a87">false</span>
</span></span><span style="display:flex;"><span>    - Name:      java_buildpack
</span></span><span style="display:flex;"><span>      URL:       https://github.com/cloudfoundry/java-buildpack
</span></span><span style="display:flex;"><span>      Disabled:  <span style="color:#204a87">false</span>
</span></span><span style="display:flex;"><span>    Stacks V2:
</span></span><span style="display:flex;"><span>    - Image:  cloudfoundry/cflinuxfs3
</span></span><span style="display:flex;"><span>      Name:   cflinuxfs3
</span></span><span style="display:flex;"><span>    Stacks V3:
</span></span><span style="display:flex;"><span>    - Build Image:  cloudfoundry/cnb:cflinuxfs3
</span></span><span style="display:flex;"><span>      Description:  A large Cloud Foundry stack based on Ubuntu 18.04
</span></span><span style="display:flex;"><span>      Name:         org.cloudfoundry.stacks.cflinuxfs3
</span></span><span style="display:flex;"><span>      Run Image:    cloudfoundry/run:full-cnb
</span></span></code></pre></div><p>Under the <code>Build Config</code> section there are three fields to look at:</p>
<ul>
<li>Buildpacks V2 contains a list of V2 compatible buildpacks in the order they&rsquo;ll be run</li>
<li>Stacks V2 indicates the stacks that can be chosen to trigger a V2 buildpack build</li>
<li>Stacks V3 indicates the stacks that can be chosen to trigger a V3 buildpack build</li>
</ul>
<p>You can also list the stacks with <code>kf stacks</code>:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf stacks
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Getting stacks in Space: buildpack-docs
</span></span><span style="display:flex;"><span>Version  Name                                Build Image                  Run Image                  Description
</span></span><span style="display:flex;"><span>V2       cflinuxfs3                          cloudfoundry/cflinuxfs3      cloudfoundry/cflinuxfs3
</span></span><span style="display:flex;"><span>V3       org.cloudfoundry.stacks.cflinuxfs3  cloudfoundry/cnb:cflinuxfs3  cloudfoundry/run:full-cnb  A large Cloud Foundry stack based on Ubuntu 18.04
</span></span></code></pre></div><p>Because V3 build images already have their buildpacks built-in, you must use <code>kf buildpacks</code> to get the list:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf buildpacks
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Getting buildpacks in Space: buildpack-docs
</span></span><span style="display:flex;"><span>Buildpacks <span style="color:#204a87;font-weight:bold">for</span> V2 stacks:
</span></span><span style="display:flex;"><span>  Name                   Position  URL
</span></span><span style="display:flex;"><span>  staticfile_buildpack   <span style="color:#0000cf;font-weight:bold">0</span>         https://github.com/cloudfoundry/staticfile-buildpack
</span></span><span style="display:flex;"><span>  java_buildpack         <span style="color:#0000cf;font-weight:bold">1</span>         https://github.com/cloudfoundry/java-buildpack
</span></span><span style="display:flex;"><span>V3 Stack: org.cloudfoundry.stacks.cflinuxfs3:
</span></span><span style="display:flex;"><span>  Name                                        Position  Version     Latest
</span></span><span style="display:flex;"><span>  org.cloudfoundry.jdbc                       <span style="color:#0000cf;font-weight:bold">0</span>         v1.0.179    <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>  org.cloudfoundry.jmx                        <span style="color:#0000cf;font-weight:bold">1</span>         v1.0.180    <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>  org.cloudfoundry.go                         <span style="color:#0000cf;font-weight:bold">2</span>         v0.0.2      <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>  org.cloudfoundry.tomcat                     <span style="color:#0000cf;font-weight:bold">3</span>         v1.1.102    <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>  org.cloudfoundry.distzip                    <span style="color:#0000cf;font-weight:bold">4</span>         v1.0.171    <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>  org.cloudfoundry.springboot                 <span style="color:#0000cf;font-weight:bold">5</span>         v1.1.2      <span style="color:#204a87">true</span>
</span></span><span style="display:flex;"><span>  ...
</span></span></code></pre></div><h2 id="customize-v3-buildpacks">Customize V3 buildpacks</h2>
<p>You can customize the buildpacks that are available to your developers by
creating your own builder image with exactly the buildpacks they should have
access to. You can also use builder images published by other authors.</p>
<h3 id="use-a-third-party-builder-image">Use a third-party builder image</h3>
<p>A list of published CNB stacks is available from the
<a href="https://buildpacks.io/docs/install-pack/">Buildpack CLI <code>pack</code></a>.
As of this writing, <code>pack suggest-stacks</code> outputs:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>pack suggest-stacks
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Stacks maintained by the community:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Stack ID: heroku-18
</span></span><span style="display:flex;"><span>    Description: The official Heroku stack based on Ubuntu 18.04
</span></span><span style="display:flex;"><span>    Maintainer: Heroku
</span></span><span style="display:flex;"><span>    Build Image: heroku/pack:18-build
</span></span><span style="display:flex;"><span>    Run Image: heroku/pack:18
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Stack ID: io.buildpacks.stacks.bionic
</span></span><span style="display:flex;"><span>    Description: A minimal Cloud Foundry stack based on Ubuntu 18.04
</span></span><span style="display:flex;"><span>    Maintainer: Cloud Foundry
</span></span><span style="display:flex;"><span>    Build Image: cloudfoundry/build:base-cnb
</span></span><span style="display:flex;"><span>    Run Image: cloudfoundry/run:base-cnb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Stack ID: org.cloudfoundry.stacks.cflinuxfs3
</span></span><span style="display:flex;"><span>    Description: A large Cloud Foundry stack based on Ubuntu 18.04
</span></span><span style="display:flex;"><span>    Maintainer: Cloud Foundry
</span></span><span style="display:flex;"><span>    Build Image: cloudfoundry/build:full-cnb
</span></span><span style="display:flex;"><span>    Run Image: cloudfoundry/run:full-cnb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Stack ID: org.cloudfoundry.stacks.tiny
</span></span><span style="display:flex;"><span>    Description: A tiny Cloud Foundry stack based on Ubuntu 18.04, similar to distroless
</span></span><span style="display:flex;"><span>    Maintainer: Cloud Foundry
</span></span><span style="display:flex;"><span>    Build Image: cloudfoundry/build:tiny-cnb
</span></span><span style="display:flex;"><span>    Run Image: cloudfoundry/run:tiny-cnb
</span></span></code></pre></div><p>To modify Kf to use the stack published by Heroku, edit
<code>kfsystem</code> Custom Resource, which automatically updates the <code>config-defaults</code> ConfigMap in the <code>kf</code> Namespace.
Add an entry to the <code>spaceStacksV3</code> key like the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl edit kfsystem kfsystem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>spaceStacksV3: <span style="color:#000;font-weight:bold">|</span>
</span></span><span style="display:flex;"><span>  - name: org.cloudfoundry.stacks.cflinuxfs3
</span></span><span style="display:flex;"><span>    description: A large Cloud Foundry stack based on Ubuntu 18.04
</span></span><span style="display:flex;"><span>    buildImage: cloudfoundry/cnb:cflinuxfs3
</span></span><span style="display:flex;"><span>    runImage: cloudfoundry/run:full-cnb
</span></span><span style="display:flex;"><span>  - name: heroku-18
</span></span><span style="display:flex;"><span>    description: The official Heroku stack based on Ubuntu 18.04
</span></span><span style="display:flex;"><span>    buildImage: heroku/pack:18-build
</span></span><span style="display:flex;"><span>    runImage: heroku/pack:18
</span></span></code></pre></div><p>Then, run <code>stacks</code> again:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kf stacks
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Getting stacks in Space: buildpack-docs
</span></span><span style="display:flex;"><span>Version  Name                                Build Image                  Run Image                  Description
</span></span><span style="display:flex;"><span>V2       cflinuxfs3                          cloudfoundry/cflinuxfs3      cloudfoundry/cflinuxfs3
</span></span><span style="display:flex;"><span>V3       org.cloudfoundry.stacks.cflinuxfs3  cloudfoundry/cnb:cflinuxfs3  cloudfoundry/run:full-cnb  A large Cloud Foundry stack based on Ubuntu 18.04
</span></span><span style="display:flex;"><span>V3       heroku-18                           heroku/pack:18-build         heroku/pack:18             The official Heroku stack based on Ubuntu 18.04
</span></span></code></pre></div><h3 id="create-your-own-builder-image">Create your own builder image</h3>
<p>The <a href="https://buildpacks.io/docs/install-pack/">Buildpack CLI <code>pack</code></a>
is used to create your own builder image. You can follow <code>pack</code>&rsquo;s
<a href="https://buildpacks.io/docs/using-pack/working-with-builders/">Working with builders using <code>create-builder</code></a>
documentation to create your own builder image. After it&rsquo;s created, push it to a
container registry and add it to the <code>kfsystem</code> Custom Resource.</p>
<h2 id="set-a-default-stack">Set a default stack</h2>
<p>Apps will be assigned a default stack if one isn&rsquo;t supplied in their manifest.
The default stack is the first in the V2 or V3 stacks list. Unless overridden,
a V2 stack is chosen for compatibility with Cloud Foundry.</p>
<p>You can force Kf to use a V3 stack instead of a V2 by setting the
<code>spaceDefaultToV3Stack</code> field in the <code>kfsystem</code> Custom Resource to be <code>&quot;true&quot;</code> (<code>kfsystem</code> automatically updates corresonding <code>spaceDefaultToV3Stack</code> field in the <code>config-defaults</code> ConfigMap):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>kubectl edit kfsystem kfsystem
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>spaceDefaultToV3Stack: <span style="color:#4e9a06">&#34;true&#34;</span>
</span></span></code></pre></div><p>This option can also be modified on a per-Space basis by changing setting the
<code>spec.buildConfig.defaultToV3Stack</code> field to be <code>true</code> or <code>false</code>. If unset,
the value from the <code>config-defaults</code> ConfigMap is used.</p>
<table>
<thead>
<tr>
<th><code>config-defaults</code> value for <code>spaceDefaultToV3Stack</code></th>
<th>Space&rsquo;s <code>spec.buildConfig.defaultToV3Stack</code></th>
<th>Default stack</th>
</tr>
</thead>
<tbody>
<tr>
<td><em>unset</em></td>
<td><em>unset</em></td>
<td>V2</td>
</tr>
<tr>
<td><code>&quot;false&quot;</code></td>
<td><em>unset</em></td>
<td>V2</td>
</tr>
<tr>
<td><code>&quot;true&quot;</code></td>
<td><em>unset</em></td>
<td>V3</td>
</tr>
<tr>
<td><em>any</em></td>
<td><code>false</code></td>
<td>V2</td>
</tr>
<tr>
<td><em>any</em></td>
<td><code>true</code></td>
<td>V3</td>
</tr>
</tbody>
</table>

</div>



    
	
  

    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/google/kf" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Security mailing list" aria-label="Security mailing list">
    <a class="text-white" target="_blank" rel="noopener" href="mailto:kf-security@google.com" aria-label="Security mailing list">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 The Kf Authors All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js"
    integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA=="
    crossorigin="anonymous"></script>





<script src='/js/tabpane-persist.js'></script>




















<script src="/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js" integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin="anonymous"></script>




  </body>
</html>
